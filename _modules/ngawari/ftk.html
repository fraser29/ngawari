

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ngawari.ftk &mdash; Ngawari 0.1.7 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=ca7ad2ea"></script>
      <script src="../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Ngawari
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#installation-methods">Installation Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../installation.html#from-pypi-recommended">From PyPI (Recommended)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../installation.html#from-source">From Source</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../installation.html#development-installation">Development Installation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#verifying-installation">Verifying Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../installation.html#version-compatibility">Version Compatibility</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Quick Start Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart.html#basic-concepts">Basic Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart.html#creating-basic-geometry">Creating Basic Geometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart.html#working-with-arrays">Working with Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart.html#filtering-operations">Filtering Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart.html#clipping-and-cutting">Clipping and Cutting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart.html#file-i-o">File I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart.html#mathematical-operations">Mathematical Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart.html#complete-example">Complete Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/index.html#core-modules">Core Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/ftk.html">ftk - Mathematical and Utility Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.getIDOfClosestFloat"><code class="docutils literal notranslate"><span class="pre">getIDOfClosestFloat()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.getClosestFloat"><code class="docutils literal notranslate"><span class="pre">getClosestFloat()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.getIDOfClosestPoint"><code class="docutils literal notranslate"><span class="pre">getIDOfClosestPoint()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.getClosestPoint"><code class="docutils literal notranslate"><span class="pre">getClosestPoint()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.distPointPoints"><code class="docutils literal notranslate"><span class="pre">distPointPoints()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.squareDistPointPoints"><code class="docutils literal notranslate"><span class="pre">squareDistPointPoints()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.sortedIDsOfClosestPoints"><code class="docutils literal notranslate"><span class="pre">sortedIDsOfClosestPoints()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.distTwoPoints"><code class="docutils literal notranslate"><span class="pre">distTwoPoints()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.getIDsOfClosestPoints"><code class="docutils literal notranslate"><span class="pre">getIDsOfClosestPoints()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.getIDsOfFartherestPoints"><code class="docutils literal notranslate"><span class="pre">getIDsOfFartherestPoints()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.vectorMagnitudes"><code class="docutils literal notranslate"><span class="pre">vectorMagnitudes()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.normaliseArray"><code class="docutils literal notranslate"><span class="pre">normaliseArray()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.angleBetween2Vec"><code class="docutils literal notranslate"><span class="pre">angleBetween2Vec()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.angleBetweenVecAndPlane"><code class="docutils literal notranslate"><span class="pre">angleBetweenVecAndPlane()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.areVecsMatching"><code class="docutils literal notranslate"><span class="pre">areVecsMatching()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.linearFit"><code class="docutils literal notranslate"><span class="pre">linearFit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.fitPlaneToPoints"><code class="docutils literal notranslate"><span class="pre">fitPlaneToPoints()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.polyfit2d"><code class="docutils literal notranslate"><span class="pre">polyfit2d()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.polyval2d"><code class="docutils literal notranslate"><span class="pre">polyval2d()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.projectPtsToPlane"><code class="docutils literal notranslate"><span class="pre">projectPtsToPlane()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.project3DPointsToPlanarCoordinateSystem"><code class="docutils literal notranslate"><span class="pre">project3DPointsToPlanarCoordinateSystem()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.project3DPointsToPlanarCoordinateSystem_OLD"><code class="docutils literal notranslate"><span class="pre">project3DPointsToPlanarCoordinateSystem_OLD()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.project3DPointsToPlanarCoordinateSystem2"><code class="docutils literal notranslate"><span class="pre">project3DPointsToPlanarCoordinateSystem2()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.convert2DPointsTo3DCoordinateSystem"><code class="docutils literal notranslate"><span class="pre">convert2DPointsTo3DCoordinateSystem()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.fitCircle2D"><code class="docutils literal notranslate"><span class="pre">fitCircle2D()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.fitCircleRANSAC"><code class="docutils literal notranslate"><span class="pre">fitCircleRANSAC()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.fitCircleRANSAC3D_xyz"><code class="docutils literal notranslate"><span class="pre">fitCircleRANSAC3D_xyz()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.fit_ellipse_2d"><code class="docutils literal notranslate"><span class="pre">fit_ellipse_2d()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.fit_ellipse_3d"><code class="docutils literal notranslate"><span class="pre">fit_ellipse_3d()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.buildCircle3D"><code class="docutils literal notranslate"><span class="pre">buildCircle3D()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.fitPlaneToPointCloud_RANSAC"><code class="docutils literal notranslate"><span class="pre">fitPlaneToPointCloud_RANSAC()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.deg2rad"><code class="docutils literal notranslate"><span class="pre">deg2rad()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.rad2deg"><code class="docutils literal notranslate"><span class="pre">rad2deg()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.rotateArray"><code class="docutils literal notranslate"><span class="pre">rotateArray()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.rotationMatrixFromThreeAngles"><code class="docutils literal notranslate"><span class="pre">rotationMatrixFromThreeAngles()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.getClosestInSortedList"><code class="docutils literal notranslate"><span class="pre">getClosestInSortedList()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.getIdOfClosestFloat"><code class="docutils literal notranslate"><span class="pre">getIdOfClosestFloat()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.polar2Cart"><code class="docutils literal notranslate"><span class="pre">polar2Cart()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.polar2z"><code class="docutils literal notranslate"><span class="pre">polar2z()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.z2Polar"><code class="docutils literal notranslate"><span class="pre">z2Polar()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.cart2Polar"><code class="docutils literal notranslate"><span class="pre">cart2Polar()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.unit_vector"><code class="docutils literal notranslate"><span class="pre">unit_vector()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.vecFromPtToLine"><code class="docutils literal notranslate"><span class="pre">vecFromPtToLine()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.fcdot"><code class="docutils literal notranslate"><span class="pre">fcdot()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.cosineDifferenceBetweenTwoMats"><code class="docutils literal notranslate"><span class="pre">cosineDifferenceBetweenTwoMats()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.getVectorComponentAlongRefVec"><code class="docutils literal notranslate"><span class="pre">getVectorComponentAlongRefVec()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.getVectorComponentAlongRefVec_Mag"><code class="docutils literal notranslate"><span class="pre">getVectorComponentAlongRefVec_Mag()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.getVectorComponentNormalToRefVec"><code class="docutils literal notranslate"><span class="pre">getVectorComponentNormalToRefVec()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.closeCurve"><code class="docutils literal notranslate"><span class="pre">closeCurve()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.splinePoints"><code class="docutils literal notranslate"><span class="pre">splinePoints()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.splineFunction"><code class="docutils literal notranslate"><span class="pre">splineFunction()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.splineXY"><code class="docutils literal notranslate"><span class="pre">splineXY()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.splineCurve"><code class="docutils literal notranslate"><span class="pre">splineCurve()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.getMaxsMinsInflections"><code class="docutils literal notranslate"><span class="pre">getMaxsMinsInflections()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.sigmoidFunction"><code class="docutils literal notranslate"><span class="pre">sigmoidFunction()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.extractContinuousSegFromPeriodic"><code class="docutils literal notranslate"><span class="pre">extractContinuousSegFromPeriodic()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.fitGaussianToData"><code class="docutils literal notranslate"><span class="pre">fitGaussianToData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.gaussianFunction"><code class="docutils literal notranslate"><span class="pre">gaussianFunction()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.calculate_signed_area_2d"><code class="docutils literal notranslate"><span class="pre">calculate_signed_area_2d()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.isClosedPolygonClockwise"><code class="docutils literal notranslate"><span class="pre">isClosedPolygonClockwise()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.ensureClosedPolyIsClockwise"><code class="docutils literal notranslate"><span class="pre">ensureClosedPolyIsClockwise()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.setFirstPtOfPolygon"><code class="docutils literal notranslate"><span class="pre">setFirstPtOfPolygon()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.reorderPointsStartClosestToX"><code class="docutils literal notranslate"><span class="pre">reorderPointsStartClosestToX()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.reorderPointsStatingAti"><code class="docutils literal notranslate"><span class="pre">reorderPointsStatingAti()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.sortPointsByClosest_RETURNIDs"><code class="docutils literal notranslate"><span class="pre">sortPointsByClosest_RETURNIDs()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.sortPointsByClosest"><code class="docutils literal notranslate"><span class="pre">sortPointsByClosest()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.cumulativeDistanceAlongLine"><code class="docutils literal notranslate"><span class="pre">cumulativeDistanceAlongLine()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.getIdOfPointClosestToX"><code class="docutils literal notranslate"><span class="pre">getIdOfPointClosestToX()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.getPolygonMeanRadius"><code class="docutils literal notranslate"><span class="pre">getPolygonMeanRadius()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.getPolygonMeanDiameter"><code class="docutils literal notranslate"><span class="pre">getPolygonMeanDiameter()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.getPolygonCenterPoint"><code class="docutils literal notranslate"><span class="pre">getPolygonCenterPoint()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.lineMagnitude"><code class="docutils literal notranslate"><span class="pre">lineMagnitude()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.distancePointToLineSegPerpendicular"><code class="docutils literal notranslate"><span class="pre">distancePointToLineSegPerpendicular()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.ndarrayToListOfTuple3"><code class="docutils literal notranslate"><span class="pre">ndarrayToListOfTuple3()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.diff"><code class="docutils literal notranslate"><span class="pre">diff()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.circleFit2DErr"><code class="docutils literal notranslate"><span class="pre">circleFit2DErr()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.distanceToPlane"><code class="docutils literal notranslate"><span class="pre">distanceToPlane()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.residualPlane"><code class="docutils literal notranslate"><span class="pre">residualPlane()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.residualsCircle"><code class="docutils literal notranslate"><span class="pre">residualsCircle()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.icp"><code class="docutils literal notranslate"><span class="pre">icp()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.fitPlane3DOptimize"><code class="docutils literal notranslate"><span class="pre">fitPlane3DOptimize()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.fitCircle3D"><code class="docutils literal notranslate"><span class="pre">fitCircle3D()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.lagBetweenTwoCurves"><code class="docutils literal notranslate"><span class="pre">lagBetweenTwoCurves()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.calculatePlaneThreePoints"><code class="docutils literal notranslate"><span class="pre">calculatePlaneThreePoints()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.getPlaneConstantsFromPointAndVector"><code class="docutils literal notranslate"><span class="pre">getPlaneConstantsFromPointAndVector()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.calculateDerivativeOnLine_backwardDiff"><code class="docutils literal notranslate"><span class="pre">calculateDerivativeOnLine_backwardDiff()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.calculateSecondDerivativeOnLine"><code class="docutils literal notranslate"><span class="pre">calculateSecondDerivativeOnLine()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.calculateCurvature3Pts"><code class="docutils literal notranslate"><span class="pre">calculateCurvature3Pts()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.calculateCurvature_D"><code class="docutils literal notranslate"><span class="pre">calculateCurvature_D()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.setVectorDirection"><code class="docutils literal notranslate"><span class="pre">setVectorDirection()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.buildRotationMatrix"><code class="docutils literal notranslate"><span class="pre">buildRotationMatrix()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.adjustPointsCenterOfMassToOrigin"><code class="docutils literal notranslate"><span class="pre">adjustPointsCenterOfMassToOrigin()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.areVecsConsistent"><code class="docutils literal notranslate"><span class="pre">areVecsConsistent()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.setVecAConsitentWithVecB"><code class="docutils literal notranslate"><span class="pre">setVecAConsitentWithVecB()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.buildConvexHUll3D"><code class="docutils literal notranslate"><span class="pre">buildConvexHUll3D()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.orderPointsConvexHull_IDs"><code class="docutils literal notranslate"><span class="pre">orderPointsConvexHull_IDs()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.orderPointsConvexHull"><code class="docutils literal notranslate"><span class="pre">orderPointsConvexHull()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.groupContinuousLinesByTol"><code class="docutils literal notranslate"><span class="pre">groupContinuousLinesByTol()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.buildContinuousLineByClosestPt"><code class="docutils literal notranslate"><span class="pre">buildContinuousLineByClosestPt()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.accumulatedAverage"><code class="docutils literal notranslate"><span class="pre">accumulatedAverage()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.interpolateNANsFromSurroundingValues_cubic"><code class="docutils literal notranslate"><span class="pre">interpolateNANsFromSurroundingValues_cubic()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.doesLineSegPierceTriangle"><code class="docutils literal notranslate"><span class="pre">doesLineSegPierceTriangle()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.doesLinePierceTriangle"><code class="docutils literal notranslate"><span class="pre">doesLinePierceTriangle()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.pluckerSideOperator"><code class="docutils literal notranslate"><span class="pre">pluckerSideOperator()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.pluckerLine"><code class="docutils literal notranslate"><span class="pre">pluckerLine()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.doesVectorPierceAnyTriangle"><code class="docutils literal notranslate"><span class="pre">doesVectorPierceAnyTriangle()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.calculateBSA"><code class="docutils literal notranslate"><span class="pre">calculateBSA()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.interpolateNANsFromSurroundingValues_linear"><code class="docutils literal notranslate"><span class="pre">interpolateNANsFromSurroundingValues_linear()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#ngawari.ftk.convexHull"><code class="docutils literal notranslate"><span class="pre">convexHull()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#vector-operations">Vector Operations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#matrix-operations">Matrix Operations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#geometric-calculations">Geometric Calculations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#point-and-line-utilities">Point and Line Utilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/ftk.html#mathematical-transformations">Mathematical Transformations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/fIO.html">fIO - File Input/Output</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.remove_symbols"><code class="docutils literal notranslate"><span class="pre">remove_symbols()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.remove_not_allowed"><code class="docutils literal notranslate"><span class="pre">remove_not_allowed()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.countFilesInDir"><code class="docutils literal notranslate"><span class="pre">countFilesInDir()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.getAllFilesUnderDir"><code class="docutils literal notranslate"><span class="pre">getAllFilesUnderDir()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.parseFileToTagsDictionary"><code class="docutils literal notranslate"><span class="pre">parseFileToTagsDictionary()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.writeDictionaryToFile"><code class="docutils literal notranslate"><span class="pre">writeDictionaryToFile()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.NumpyEncoder"><code class="docutils literal notranslate"><span class="pre">NumpyEncoder</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.writeDictionaryToJSON"><code class="docutils literal notranslate"><span class="pre">writeDictionaryToJSON()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.parseJsonToDictionary"><code class="docutils literal notranslate"><span class="pre">parseJsonToDictionary()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.strListToFloatList"><code class="docutils literal notranslate"><span class="pre">strListToFloatList()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.xmlIndent"><code class="docutils literal notranslate"><span class="pre">xmlIndent()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.findAndReplaceTextInFile"><code class="docutils literal notranslate"><span class="pre">findAndReplaceTextInFile()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.readFileToListOfLines"><code class="docutils literal notranslate"><span class="pre">readFileToListOfLines()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.appendFiles"><code class="docutils literal notranslate"><span class="pre">appendFiles()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.pickleData"><code class="docutils literal notranslate"><span class="pre">pickleData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.unpickleData"><code class="docutils literal notranslate"><span class="pre">unpickleData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.tarGZLocal_AndMove"><code class="docutils literal notranslate"><span class="pre">tarGZLocal_AndMove()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.addSuffixToName"><code class="docutils literal notranslate"><span class="pre">addSuffixToName()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.checkIfExtnPresent"><code class="docutils literal notranslate"><span class="pre">checkIfExtnPresent()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.readDataCSV"><code class="docutils literal notranslate"><span class="pre">readDataCSV()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.writeCSVFile"><code class="docutils literal notranslate"><span class="pre">writeCSVFile()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.detectDelimiter"><code class="docutils literal notranslate"><span class="pre">detectDelimiter()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.writePlyFile"><code class="docutils literal notranslate"><span class="pre">writePlyFile()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.writeVTKFile"><code class="docutils literal notranslate"><span class="pre">writeVTKFile()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.readVTKFile"><code class="docutils literal notranslate"><span class="pre">readVTKFile()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.nii_to_niigz"><code class="docutils literal notranslate"><span class="pre">nii_to_niigz()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.writeNifti"><code class="docutils literal notranslate"><span class="pre">writeNifti()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.readNifti"><code class="docutils literal notranslate"><span class="pre">readNifti()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.readNRRD"><code class="docutils literal notranslate"><span class="pre">readNRRD()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.writeVTK_PVD_Dict"><code class="docutils literal notranslate"><span class="pre">writeVTK_PVD_Dict()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.pvdAddTimeToFieldData"><code class="docutils literal notranslate"><span class="pre">pvdAddTimeToFieldData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.writeZipFromVTK_PVD_Dict"><code class="docutils literal notranslate"><span class="pre">writeZipFromVTK_PVD_Dict()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.deleteFilesByPVD"><code class="docutils literal notranslate"><span class="pre">deleteFilesByPVD()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.readPVDFileName"><code class="docutils literal notranslate"><span class="pre">readPVDFileName()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.readImageFileToDict"><code class="docutils literal notranslate"><span class="pre">readImageFileToDict()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.readPVD"><code class="docutils literal notranslate"><span class="pre">readPVD()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.pvdGetDict"><code class="docutils literal notranslate"><span class="pre">pvdGetDict()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.pvdGetClosestTimeToT"><code class="docutils literal notranslate"><span class="pre">pvdGetClosestTimeToT()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.pvdGetTimes"><code class="docutils literal notranslate"><span class="pre">pvdGetTimes()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.pvdGetIdOfT"><code class="docutils literal notranslate"><span class="pre">pvdGetIdOfT()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.pvdGetFileAtT"><code class="docutils literal notranslate"><span class="pre">pvdGetFileAtT()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.pvdGetNumberTimePoints"><code class="docutils literal notranslate"><span class="pre">pvdGetNumberTimePoints()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.pvdGetDataFileRoot_Prefix_and_Ext"><code class="docutils literal notranslate"><span class="pre">pvdGetDataFileRoot_Prefix_and_Ext()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.pvdGetDataClosestTo"><code class="docutils literal notranslate"><span class="pre">pvdGetDataClosestTo()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.pvdMultiply"><code class="docutils literal notranslate"><span class="pre">pvdMultiply()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.pvdReverse"><code class="docutils literal notranslate"><span class="pre">pvdReverse()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.pvdRestart_t"><code class="docutils literal notranslate"><span class="pre">pvdRestart_t()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.pvdRestart"><code class="docutils literal notranslate"><span class="pre">pvdRestart()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.pvdClip"><code class="docutils literal notranslate"><span class="pre">pvdClip()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.pvdResetTimes"><code class="docutils literal notranslate"><span class="pre">pvdResetTimes()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.pvdResetStartPoint_Id"><code class="docutils literal notranslate"><span class="pre">pvdResetStartPoint_Id()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.pvdResetStartPoint"><code class="docutils literal notranslate"><span class="pre">pvdResetStartPoint()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.pvdAddStartPointAtEndForPeriodicy"><code class="docutils literal notranslate"><span class="pre">pvdAddStartPointAtEndForPeriodicy()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#ngawari.fIO.buildPVD_WaterFallRestarts"><code class="docutils literal notranslate"><span class="pre">buildPVD_WaterFallRestarts()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#vtk-file-formats">VTK File Formats</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#other-file-formats">Other File Formats</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#pvd-file-operations">PVD File Operations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#data-conversion">Data Conversion</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/fIO.html#batch-processing">Batch Processing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/vtkfilters.html">vtkfilters - VTK Filtering and Processing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.isVTI"><code class="docutils literal notranslate"><span class="pre">isVTI()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.isVTP"><code class="docutils literal notranslate"><span class="pre">isVTP()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.isVTS"><code class="docutils literal notranslate"><span class="pre">isVTS()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.angleBetweenTwoVectors"><code class="docutils literal notranslate"><span class="pre">angleBetweenTwoVectors()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getArrayNames"><code class="docutils literal notranslate"><span class="pre">getArrayNames()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getArray"><code class="docutils literal notranslate"><span class="pre">getArray()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getScalarsArrayName"><code class="docutils literal notranslate"><span class="pre">getScalarsArrayName()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getVectorsArrayName"><code class="docutils literal notranslate"><span class="pre">getVectorsArrayName()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getArrayId"><code class="docutils literal notranslate"><span class="pre">getArrayId()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.renameArray"><code class="docutils literal notranslate"><span class="pre">renameArray()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getArrayAsNumpy"><code class="docutils literal notranslate"><span class="pre">getArrayAsNumpy()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getScalarsAsNumpy"><code class="docutils literal notranslate"><span class="pre">getScalarsAsNumpy()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.setArrayFromNumpy"><code class="docutils literal notranslate"><span class="pre">setArrayFromNumpy()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.addNpArray"><code class="docutils literal notranslate"><span class="pre">addNpArray()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.setArrayDtype"><code class="docutils literal notranslate"><span class="pre">setArrayDtype()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.setArrayAsScalars"><code class="docutils literal notranslate"><span class="pre">setArrayAsScalars()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.setArrayAsVectors"><code class="docutils literal notranslate"><span class="pre">setArrayAsVectors()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.ensureScalarsSet"><code class="docutils literal notranslate"><span class="pre">ensureScalarsSet()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.delArray"><code class="docutils literal notranslate"><span class="pre">delArray()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.delArraysExcept"><code class="docutils literal notranslate"><span class="pre">delArraysExcept()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.addFieldData"><code class="docutils literal notranslate"><span class="pre">addFieldData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getFieldData"><code class="docutils literal notranslate"><span class="pre">getFieldData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getFieldDataDict"><code class="docutils literal notranslate"><span class="pre">getFieldDataDict()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getFieldDataNames"><code class="docutils literal notranslate"><span class="pre">getFieldDataNames()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.duplicateFieldData"><code class="docutils literal notranslate"><span class="pre">duplicateFieldData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.deleteFieldData"><code class="docutils literal notranslate"><span class="pre">deleteFieldData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getVtkPointsAsNumpy"><code class="docutils literal notranslate"><span class="pre">getVtkPointsAsNumpy()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getPtsAsNumpy"><code class="docutils literal notranslate"><span class="pre">getPtsAsNumpy()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getCellCenters"><code class="docutils literal notranslate"><span class="pre">getCellCenters()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.buildImplicitSphere"><code class="docutils literal notranslate"><span class="pre">buildImplicitSphere()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.buildSphereSource"><code class="docutils literal notranslate"><span class="pre">buildSphereSource()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.buildCylinderSource"><code class="docutils literal notranslate"><span class="pre">buildCylinderSource()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.buildImplicitBox"><code class="docutils literal notranslate"><span class="pre">buildImplicitBox()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.buildCubeSource"><code class="docutils literal notranslate"><span class="pre">buildCubeSource()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.buildPolyLineBetweenTwoPoints"><code class="docutils literal notranslate"><span class="pre">buildPolyLineBetweenTwoPoints()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.buildPolyTrianglesAtCp"><code class="docutils literal notranslate"><span class="pre">buildPolyTrianglesAtCp()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.buildPlaneCentredOnRoi"><code class="docutils literal notranslate"><span class="pre">buildPlaneCentredOnRoi()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.buildPlaneCentredOnSphere"><code class="docutils literal notranslate"><span class="pre">buildPlaneCentredOnSphere()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.buildPlanePtAndNorm"><code class="docutils literal notranslate"><span class="pre">buildPlanePtAndNorm()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.buildPlaneCentredOnO"><code class="docutils literal notranslate"><span class="pre">buildPlaneCentredOnO()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.buildPlaneSource"><code class="docutils literal notranslate"><span class="pre">buildPlaneSource()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.buildPolyLineFromXYZ_spline"><code class="docutils literal notranslate"><span class="pre">buildPolyLineFromXYZ_spline()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.buildPolyLineFromXYZ"><code class="docutils literal notranslate"><span class="pre">buildPolyLineFromXYZ()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.buildPolydataFromXYZ"><code class="docutils literal notranslate"><span class="pre">buildPolydataFromXYZ()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.clippedByCircle"><code class="docutils literal notranslate"><span class="pre">clippedByCircle()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.sliceByPlane"><code class="docutils literal notranslate"><span class="pre">sliceByPlane()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getDataCutByPlane"><code class="docutils literal notranslate"><span class="pre">getDataCutByPlane()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getPolyDataClippedByROI"><code class="docutils literal notranslate"><span class="pre">getPolyDataClippedByROI()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getPolyDataClippedByBox"><code class="docutils literal notranslate"><span class="pre">getPolyDataClippedByBox()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getPolyDataClippedBySphere"><code class="docutils literal notranslate"><span class="pre">getPolyDataClippedBySphere()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.clippedByPolyData"><code class="docutils literal notranslate"><span class="pre">clippedByPolyData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.doesLinePierceTri"><code class="docutils literal notranslate"><span class="pre">doesLinePierceTri()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.doesLinePiercePolygon"><code class="docutils literal notranslate"><span class="pre">doesLinePiercePolygon()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.clippedByPlane"><code class="docutils literal notranslate"><span class="pre">clippedByPlane()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.clipDataByPlane"><code class="docutils literal notranslate"><span class="pre">clipDataByPlane()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.clippedByPlaneClosedSurface"><code class="docutils literal notranslate"><span class="pre">clippedByPlaneClosedSurface()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.clippedBySphere"><code class="docutils literal notranslate"><span class="pre">clippedBySphere()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.clippedByScalar"><code class="docutils literal notranslate"><span class="pre">clippedByScalar()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.clipVolumeToEightPolydataBoxes"><code class="docutils literal notranslate"><span class="pre">clipVolumeToEightPolydataBoxes()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.roi_line_to_roi_plane"><code class="docutils literal notranslate"><span class="pre">roi_line_to_roi_plane()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.clipPlaneToROI"><code class="docutils literal notranslate"><span class="pre">clipPlaneToROI()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.vtiToVts"><code class="docutils literal notranslate"><span class="pre">vtiToVts()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.vtsToVti"><code class="docutils literal notranslate"><span class="pre">vtsToVti()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getVtsOrigin"><code class="docutils literal notranslate"><span class="pre">getVtsOrigin()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getVtsResolution"><code class="docutils literal notranslate"><span class="pre">getVtsResolution()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getResolution_VTI"><code class="docutils literal notranslate"><span class="pre">getResolution_VTI()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getDimsResOriginFromOutline"><code class="docutils literal notranslate"><span class="pre">getDimsResOriginFromOutline()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.buildRawImageDataFromPolyData"><code class="docutils literal notranslate"><span class="pre">buildRawImageDataFromPolyData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.buildRawImageDataFromOutline"><code class="docutils literal notranslate"><span class="pre">buildRawImageDataFromOutline()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.buildRawImageDataFromOutline_dims"><code class="docutils literal notranslate"><span class="pre">buildRawImageDataFromOutline_dims()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.duplicateImageData"><code class="docutils literal notranslate"><span class="pre">duplicateImageData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.buildRawImageData"><code class="docutils literal notranslate"><span class="pre">buildRawImageData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.surf2ImageBW"><code class="docutils literal notranslate"><span class="pre">surf2ImageBW()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getVarValueAtI_ImageData"><code class="docutils literal notranslate"><span class="pre">getVarValueAtI_ImageData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getImageX"><code class="docutils literal notranslate"><span class="pre">getImageX()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.imageX_ToStructuredCoords"><code class="docutils literal notranslate"><span class="pre">imageX_ToStructuredCoords()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.imageIndex_ToStructuredCoords"><code class="docutils literal notranslate"><span class="pre">imageIndex_ToStructuredCoords()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getNeighbours26_fromImageIndex"><code class="docutils literal notranslate"><span class="pre">getNeighbours26_fromImageIndex()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.imageStrucCoords_toIndex"><code class="docutils literal notranslate"><span class="pre">imageStrucCoords_toIndex()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.imageStrucCoords_toX"><code class="docutils literal notranslate"><span class="pre">imageStrucCoords_toX()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.filterFlipImageData"><code class="docutils literal notranslate"><span class="pre">filterFlipImageData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getPolyDataMeanFromCenter"><code class="docutils literal notranslate"><span class="pre">getPolyDataMeanFromCenter()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.copyPolyData"><code class="docutils literal notranslate"><span class="pre">copyPolyData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.copyData"><code class="docutils literal notranslate"><span class="pre">copyData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.contourFilter"><code class="docutils literal notranslate"><span class="pre">contourFilter()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.cleanData"><code class="docutils literal notranslate"><span class="pre">cleanData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.reduceNumberOfPoints"><code class="docutils literal notranslate"><span class="pre">reduceNumberOfPoints()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.filterBoolean"><code class="docutils literal notranslate"><span class="pre">filterBoolean()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.tubeFilter"><code class="docutils literal notranslate"><span class="pre">tubeFilter()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.filterVtpSpline"><code class="docutils literal notranslate"><span class="pre">filterVtpSpline()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.filterTransformPolyData"><code class="docutils literal notranslate"><span class="pre">filterTransformPolyData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.translatePoly_AxisA_To_AxisB"><code class="docutils literal notranslate"><span class="pre">translatePoly_AxisA_To_AxisB()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.transformPolydataA_to_B_ICP"><code class="docutils literal notranslate"><span class="pre">transformPolydataA_to_B_ICP()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.iterativeClosestPointsTransform"><code class="docutils literal notranslate"><span class="pre">iterativeClosestPointsTransform()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.filterWarpPolydataByVectors"><code class="docutils literal notranslate"><span class="pre">filterWarpPolydataByVectors()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.transformImageData"><code class="docutils literal notranslate"><span class="pre">transformImageData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.pointToCellData"><code class="docutils literal notranslate"><span class="pre">pointToCellData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.cellToPointData"><code class="docutils literal notranslate"><span class="pre">cellToPointData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getOutline"><code class="docutils literal notranslate"><span class="pre">getOutline()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getMaximumBounds"><code class="docutils literal notranslate"><span class="pre">getMaximumBounds()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.appendPolyData"><code class="docutils literal notranslate"><span class="pre">appendPolyData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.appendPolyDataList"><code class="docutils literal notranslate"><span class="pre">appendPolyDataList()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.appendImageList"><code class="docutils literal notranslate"><span class="pre">appendImageList()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.appendUnstructured"><code class="docutils literal notranslate"><span class="pre">appendUnstructured()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.mergeTwoImageData"><code class="docutils literal notranslate"><span class="pre">mergeTwoImageData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.multiblockToList"><code class="docutils literal notranslate"><span class="pre">multiblockToList()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.idListToVtkIDs"><code class="docutils literal notranslate"><span class="pre">idListToVtkIDs()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.extractCells"><code class="docutils literal notranslate"><span class="pre">extractCells()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.extractSelection"><code class="docutils literal notranslate"><span class="pre">extractSelection()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.delCellsByEdgeLength"><code class="docutils literal notranslate"><span class="pre">delCellsByEdgeLength()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.delCellsByID"><code class="docutils literal notranslate"><span class="pre">delCellsByID()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getPolylineLength"><code class="docutils literal notranslate"><span class="pre">getPolylineLength()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getLoopSubDivided"><code class="docutils literal notranslate"><span class="pre">getLoopSubDivided()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.decimateTris"><code class="docutils literal notranslate"><span class="pre">decimateTris()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.shrinkWrapData"><code class="docutils literal notranslate"><span class="pre">shrinkWrapData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.poissonRecon"><code class="docutils literal notranslate"><span class="pre">poissonRecon()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.pointCloudRemoveOutliers"><code class="docutils literal notranslate"><span class="pre">pointCloudRemoveOutliers()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.smoothTris"><code class="docutils literal notranslate"><span class="pre">smoothTris()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.smoothTris_SINC"><code class="docutils literal notranslate"><span class="pre">smoothTris_SINC()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.filterExtractEdges"><code class="docutils literal notranslate"><span class="pre">filterExtractEdges()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.isPolyDataWaterTight"><code class="docutils literal notranslate"><span class="pre">isPolyDataWaterTight()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.isPolyDataPolyLine"><code class="docutils literal notranslate"><span class="pre">isPolyDataPolyLine()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.calculatePolyDataArea"><code class="docutils literal notranslate"><span class="pre">calculatePolyDataArea()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getPolyDataCenterPtNormal"><code class="docutils literal notranslate"><span class="pre">getPolyDataCenterPtNormal()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.addMagnitudeArray"><code class="docutils literal notranslate"><span class="pre">addMagnitudeArray()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.addNormalVelocities"><code class="docutils literal notranslate"><span class="pre">addNormalVelocities()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.filterDilateErode"><code class="docutils literal notranslate"><span class="pre">filterDilateErode()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.filterExtractSurface"><code class="docutils literal notranslate"><span class="pre">filterExtractSurface()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.filterExtractTri"><code class="docutils literal notranslate"><span class="pre">filterExtractTri()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.filterTriangulate"><code class="docutils literal notranslate"><span class="pre">filterTriangulate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getVolumeSurfaceAreaOfPolyData"><code class="docutils literal notranslate"><span class="pre">getVolumeSurfaceAreaOfPolyData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.mergeSurfsByPointsInsideVti"><code class="docutils literal notranslate"><span class="pre">mergeSurfsByPointsInsideVti()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getTriangleAreaAndNormal"><code class="docutils literal notranslate"><span class="pre">getTriangleAreaAndNormal()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.addNormalsToPolyData"><code class="docutils literal notranslate"><span class="pre">addNormalsToPolyData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getBoundaryEdges"><code class="docutils literal notranslate"><span class="pre">getBoundaryEdges()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getEdges"><code class="docutils literal notranslate"><span class="pre">getEdges()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getConnectedCellIds"><code class="docutils literal notranslate"><span class="pre">getConnectedCellIds()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.extractStructuredSubGrid"><code class="docutils literal notranslate"><span class="pre">extractStructuredSubGrid()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.extractVOI"><code class="docutils literal notranslate"><span class="pre">extractVOI()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.extractVOI_fromFov"><code class="docutils literal notranslate"><span class="pre">extractVOI_fromFov()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.filterNullOutsideSurface"><code class="docutils literal notranslate"><span class="pre">filterNullOutsideSurface()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.filterNullInsideSurface"><code class="docutils literal notranslate"><span class="pre">filterNullInsideSurface()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.filterResampleToDataset"><code class="docutils literal notranslate"><span class="pre">filterResampleToDataset()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.filterResampleToImage"><code class="docutils literal notranslate"><span class="pre">filterResampleToImage()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getAxesDirectionCosinesForNormal"><code class="docutils literal notranslate"><span class="pre">getAxesDirectionCosinesForNormal()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.filterResliceImage"><code class="docutils literal notranslate"><span class="pre">filterResliceImage()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.filterVtiMedian"><code class="docutils literal notranslate"><span class="pre">filterVtiMedian()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.filterImageGradient"><code class="docutils literal notranslate"><span class="pre">filterImageGradient()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.filterAnisotropicDiffusion"><code class="docutils literal notranslate"><span class="pre">filterAnisotropicDiffusion()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.filterSurfaceToImageStencil"><code class="docutils literal notranslate"><span class="pre">filterSurfaceToImageStencil()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.filterMaskImageBySurface"><code class="docutils literal notranslate"><span class="pre">filterMaskImageBySurface()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.filterGetPointsInsideSurface"><code class="docutils literal notranslate"><span class="pre">filterGetPointsInsideSurface()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.filterGetPointIDsInsideSurface"><code class="docutils literal notranslate"><span class="pre">filterGetPointIDsInsideSurface()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.filterGetPolydataInsideSurface"><code class="docutils literal notranslate"><span class="pre">filterGetPolydataInsideSurface()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.filterGetEnclosedPts"><code class="docutils literal notranslate"><span class="pre">filterGetEnclosedPts()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.filterGetArrayValuesWithinSurface"><code class="docutils literal notranslate"><span class="pre">filterGetArrayValuesWithinSurface()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getDataWithThreshold"><code class="docutils literal notranslate"><span class="pre">getDataWithThreshold()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.countPointsInVti"><code class="docutils literal notranslate"><span class="pre">countPointsInVti()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getConnectedRegionLargest"><code class="docutils literal notranslate"><span class="pre">getConnectedRegionLargest()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getConnectedRegionContaining"><code class="docutils literal notranslate"><span class="pre">getConnectedRegionContaining()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getConnectedRegionClosestToX"><code class="docutils literal notranslate"><span class="pre">getConnectedRegionClosestToX()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getConnectedRegionClosestToX_UnStruct"><code class="docutils literal notranslate"><span class="pre">getConnectedRegionClosestToX_UnStruct()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getConnectedRegionAll"><code class="docutils literal notranslate"><span class="pre">getConnectedRegionAll()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#ngawari.vtkfilters.getConnectedRegionMinDistToX"><code class="docutils literal notranslate"><span class="pre">getConnectedRegionMinDistToX()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#data-type-checkers">Data Type Checkers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#array-operations">Array Operations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#geometry-creation">Geometry Creation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#filtering-operations">Filtering Operations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#clipping-and-cutting">Clipping and Cutting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#image-data-operations">Image Data Operations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#surface-operations">Surface Operations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#data-conversion">Data Conversion</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/vtkfilters.html#utility-functions">Utility Functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/index.html#module-overview">Module Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/index.html#ftk-mathematical-and-utility-functions">ftk - Mathematical and Utility Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/index.html#fio-file-input-output">fIO - File Input/Output</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/index.html#vtkfilters-vtk-filtering-and-processing">vtkfilters - VTK Filtering and Processing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/index.html#usage-examples">Usage Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/index.html#basic-import">Basic Import</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/index.html#common-patterns">Common Patterns</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/index.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples/index.html#basic-geometry-example">Basic Geometry Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/index.html#clipping-example">Clipping Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/index.html#image-data-example">Image Data Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/index.html#mathematical-operations-example">Mathematical Operations Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/index.html#file-i-o-example">File I/O Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing to Ngawari</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#development-setup">Development Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#code-style">Code Style</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#testing">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#building-documentation">Building Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#pull-request-guidelines">Pull Request Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#issue-reporting">Issue Reporting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#getting-help">Getting Help</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Ngawari</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">ngawari.ftk</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for ngawari.ftk</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">@author Fraser Callaghan</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">itertools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">optimize</span><span class="p">,</span> <span class="n">interpolate</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.spatial</span><span class="w"> </span><span class="kn">import</span> <span class="n">cKDTree</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">vtk</span>


<span class="c1"># ======================================================================================================================</span>
<span class="c1">#           MATH</span>
<span class="c1"># ======================================================================================================================</span>
<div class="viewcode-block" id="getIDOfClosestFloat">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.getIDOfClosestFloat">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">getIDOfClosestFloat</span><span class="p">(</span><span class="n">iFloat</span><span class="p">,</span> <span class="n">floatList</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">iFloat</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">floatList</span><span class="p">])</span></div>



<div class="viewcode-block" id="getClosestFloat">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.getClosestFloat">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">getClosestFloat</span><span class="p">(</span><span class="n">iFloat</span><span class="p">,</span> <span class="n">floatList</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">floatList</span><span class="p">[</span><span class="n">getIDOfClosestFloat</span><span class="p">(</span><span class="n">iFloat</span><span class="p">,</span> <span class="n">floatList</span><span class="p">)]</span></div>



<div class="viewcode-block" id="getIDOfClosestPoint">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.getIDOfClosestPoint">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">getIDOfClosestPoint</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
    <span class="n">dist_2</span> <span class="o">=</span> <span class="n">squareDistPointPoints</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">points</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">dist_2</span><span class="p">)</span></div>



<div class="viewcode-block" id="getClosestPoint">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.getClosestPoint">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">getClosestPoint</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">points</span><span class="p">[</span><span class="n">getIDOfClosestPoint</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">points</span><span class="p">)]</span></div>



<div class="viewcode-block" id="distPointPoints">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.distPointPoints">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">distPointPoints</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
    <span class="n">dist_2</span> <span class="o">=</span> <span class="n">squareDistPointPoints</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">points</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dist_2</span><span class="p">)</span></div>



<div class="viewcode-block" id="squareDistPointPoints">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.squareDistPointPoints">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">squareDistPointPoints</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">points</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">deltas</span> <span class="o">=</span> <span class="n">points</span> <span class="o">-</span> <span class="n">point</span>
    <span class="n">dist_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,ij-&gt;i&#39;</span><span class="p">,</span> <span class="n">deltas</span><span class="p">,</span> <span class="n">deltas</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dist_2</span></div>



<div class="viewcode-block" id="sortedIDsOfClosestPoints">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.sortedIDsOfClosestPoints">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">sortedIDsOfClosestPoints</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
    <span class="n">dist_2</span> <span class="o">=</span> <span class="n">squareDistPointPoints</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">points</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">dist_2</span><span class="p">)</span></div>



<div class="viewcode-block" id="distTwoPoints">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.distTwoPoints">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">distTwoPoints</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">distPointPoints</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">[</span><span class="n">b</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span></div>



<div class="viewcode-block" id="getIDsOfClosestPoints">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.getIDsOfClosestPoints">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">getIDsOfClosestPoints</span><span class="p">(</span><span class="n">pointsA</span><span class="p">,</span> <span class="n">pointsB</span><span class="p">):</span>
    <span class="n">pointsA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pointsA</span><span class="p">)</span>
    <span class="n">pointsB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pointsB</span><span class="p">)</span>
    <span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">pointsA</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">pointsB</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">minIDa</span><span class="p">,</span> <span class="n">minIDb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">distances</span><span class="p">),</span> <span class="n">distances</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">minIDa</span><span class="p">,</span> <span class="n">minIDb</span></div>



<div class="viewcode-block" id="getIDsOfFartherestPoints">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.getIDsOfFartherestPoints">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">getIDsOfFartherestPoints</span><span class="p">(</span><span class="n">pointsA</span><span class="p">,</span> <span class="n">pointsB</span><span class="p">):</span>
    <span class="n">pointsA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pointsA</span><span class="p">)</span>
    <span class="n">pointsB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pointsB</span><span class="p">)</span>
    <span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">pointsA</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">pointsB</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">maxIDa</span><span class="p">,</span> <span class="n">maxIDb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">distances</span><span class="p">),</span> <span class="n">distances</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">maxIDa</span><span class="p">,</span> <span class="n">maxIDb</span></div>



<div class="viewcode-block" id="vectorMagnitudes">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.vectorMagnitudes">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">vectorMagnitudes</span><span class="p">(</span><span class="n">vecs</span><span class="p">):</span>
    <span class="n">vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">vecs</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vecs</span><span class="o">*</span><span class="n">vecs</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vecs</span><span class="p">)])</span></div>



<div class="viewcode-block" id="normaliseArray">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.normaliseArray">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">normaliseArray</span><span class="p">(</span><span class="n">vectors</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalise an array of vectors.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    vectors (array-like): Input array of vectors. Can be 1D or 2D.</span>

<span class="sd">    Returns:</span>
<span class="sd">    numpy.ndarray: Array of normalised vectors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">vectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">vectors</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">vectors</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">vectors</span> <span class="o">=</span> <span class="n">vectors</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">magnitudes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vectors</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">magnitudes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">magnitudes</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">)</span> <span class="c1"># Avoid division by zero</span>
    <span class="n">normalised</span> <span class="o">=</span> <span class="n">vectors</span> <span class="o">/</span> <span class="n">magnitudes</span>
    
    <span class="k">return</span> <span class="n">normalised</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span></div>



<div class="viewcode-block" id="angleBetween2Vec">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.angleBetween2Vec">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">angleBetween2Vec</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">RETURN_DEGREES</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the angle in radians between vectors &#39;v1&#39; and &#39;v2&#39;::</span>
<span class="sd">        Can be lists of same size</span>
<span class="sd">    :param v1:</span>
<span class="sd">    :param v2:</span>
<span class="sd">    :param RETURN_DEGREES:</span>
<span class="sd">    :return: angle in radians</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">RETURN_DEGREES</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkMath</span><span class="o">.</span><span class="n">DegreesFromRadians</span><span class="p">(</span><span class="n">angleBetween2Vec</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">RETURN_DEGREES</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkMath</span><span class="o">.</span><span class="n">AngleBetweenVectors</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span></div>



<div class="viewcode-block" id="angleBetweenVecAndPlane">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.angleBetweenVecAndPlane">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">angleBetweenVecAndPlane</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">planeNormal</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">planeNormal</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vector</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">planeNormal</span><span class="p">))</span></div>



<div class="viewcode-block" id="areVecsMatching">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.areVecsMatching">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">areVecsMatching</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">angleTol_rad</span><span class="p">,</span> <span class="n">magTol</span><span class="p">):</span>
    <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">m1</span> <span class="o">-</span> <span class="n">m2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">magTol</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">angleBetween2Vec</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">theta</span> <span class="o">&gt;</span> <span class="n">angleTol_rad</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">__forcePts_nx3</span><span class="p">(</span><span class="n">pts</span><span class="p">):</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">))</span> <span class="o">|</span> <span class="p">((</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)):</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">T</span>
    <span class="k">return</span> <span class="n">pts</span>


<span class="c1"># ======================================================================================================================</span>
<span class="c1">#           FITTING &amp; PROJECTION</span>
<span class="c1"># ======================================================================================================================</span>
<div class="viewcode-block" id="linearFit">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.linearFit">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">linearFit</span><span class="p">(</span><span class="n">X</span> <span class="p">,</span><span class="n">Y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fit a linear model to the data.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - X: Independent variable.</span>
<span class="sd">    - Y: Dependent variable.</span>

<span class="sd">    Returns:</span>
<span class="sd">    slope, intercept, R, pValue, std: Parameters of the linear model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">pValue</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span> <span class="c1"># c, m, R</span>
    <span class="k">return</span> <span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">pValue</span><span class="p">,</span> <span class="n">std</span></div>



<div class="viewcode-block" id="fitPlaneToPoints">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.fitPlaneToPoints">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">fitPlaneToPoints</span><span class="p">(</span><span class="n">pts</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fit a plane to a set of 3D points.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - pts: A numpy array of shape (N, 3) representing the 3D points.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - planeABC: Coefficients of the plane equation [a, b, c, d].</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">__forcePts_nx3</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">pts</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>  <span class="c1"># find position of minimal singular value</span>
    <span class="n">coeff</span> <span class="o">=</span> <span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>  <span class="c1"># this may be multiple</span>
    <span class="n">planeABC</span> <span class="o">=</span> <span class="n">coeff</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">coeff</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">Ds</span> <span class="o">=</span> <span class="p">[</span><span class="n">planeABC</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">planeABC</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">planeABC</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">planeABC</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Ds</span><span class="p">)))</span></div>



<div class="viewcode-block" id="polyfit2d">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.polyfit2d">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">polyfit2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">ncols</span> <span class="o">=</span> <span class="p">(</span><span class="n">order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">ncols</span><span class="p">))</span>
    <span class="n">ij</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ij</span><span class="p">):</span>
        <span class="n">G</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span> <span class="o">**</span> <span class="n">i</span> <span class="o">*</span> <span class="n">y</span> <span class="o">**</span> <span class="n">j</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">rcond</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">m</span></div>



<div class="viewcode-block" id="polyval2d">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.polyval2d">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">polyval2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
    <span class="n">order</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)))</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">ij</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">ij</span><span class="p">):</span>
        <span class="n">z</span> <span class="o">+=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">x</span> <span class="o">**</span> <span class="n">i</span> <span class="o">*</span> <span class="n">y</span> <span class="o">**</span> <span class="n">j</span>
    <span class="k">return</span> <span class="n">z</span></div>



<div class="viewcode-block" id="projectPtsToPlane">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.projectPtsToPlane">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">projectPtsToPlane</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">plane</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    projects the points so all lie on the plane</span>
<span class="sd">    :param pts: list/array of points Nx3</span>
<span class="sd">    :param plane: equation of plane: either [a,b,c,d] or [norm, ptInPlane]</span>
<span class="sd">    :return: pts array all lying on plane</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plane</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">planeNorm</span> <span class="o">=</span> <span class="n">plane</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">inplanePt</span> <span class="o">=</span> <span class="n">plane</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">D</span> <span class="o">=</span> <span class="o">-</span><span class="n">inplanePt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">planeNorm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">inplanePt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">planeNorm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> \
            <span class="n">inplanePt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">planeNorm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">planeNorm</span> <span class="o">=</span> <span class="n">plane</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">plane</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">__forcePts_nx3</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>
    <span class="n">fraction</span> <span class="o">=</span> <span class="p">(</span><span class="n">planeNorm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">pts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span>
                <span class="n">planeNorm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">pts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
                <span class="n">planeNorm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">pts</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">D</span><span class="p">)</span> <span class="o">/</span> \
               <span class="p">(</span><span class="n">planeNorm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">planeNorm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">planeNorm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">planeNorm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">fraction</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">planeNorm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">fraction</span>
    <span class="n">z0</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">planeNorm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">fraction</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">))</span></div>



<div class="viewcode-block" id="project3DPointsToPlanarCoordinateSystem">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.project3DPointsToPlanarCoordinateSystem">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">project3DPointsToPlanarCoordinateSystem</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">planeNorm</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">origin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">planeNorm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">normal</span> <span class="o">=</span> <span class="n">fitPlaneToPoints</span><span class="p">(</span><span class="n">pts</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">normal</span> <span class="o">=</span> <span class="n">planeNorm</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">planeNorm</span><span class="p">)</span>
    <span class="n">projected_points</span> <span class="o">=</span> <span class="n">projectPtsToPlane</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">origin</span><span class="p">))</span>
    <span class="c1"># Create a local coordinate system on the plane</span>
    <span class="c1"># Find two vectors in the plane</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">projected_points</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">projected_points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">u</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
    <span class="c1"># Convert the projected 3D points to 2D coordinates in the (u, v) plane</span>
    <span class="n">points_2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">pt</span> <span class="o">-</span> <span class="n">origin</span><span class="p">,</span> <span class="n">u</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">pt</span> <span class="o">-</span> <span class="n">origin</span><span class="p">,</span> <span class="n">v</span><span class="p">)]</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">projected_points</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">points_2d</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">origin</span></div>



<div class="viewcode-block" id="project3DPointsToPlanarCoordinateSystem_OLD">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.project3DPointsToPlanarCoordinateSystem_OLD">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">project3DPointsToPlanarCoordinateSystem_OLD</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">planeNorm</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Will rotate pts to lie in given plane</span>
<span class="sd">       - shifts pts to be centered on origin</span>
<span class="sd">        FIXME: If points are aligned with an axis (almost) then will fail.</span>
<span class="sd">       - raise LinAlgError</span>
<span class="sd">          Need to check for this, then simply rotate by different vector set.</span>
<span class="sd">    source: http://mathforum.org/library/drmath/view/51727.html</span>
<span class="sd">    source: https://stackoverflow.com/questions/23472048/projecting-3d-points-to-2d-plane</span>
<span class="sd">    :param pts:</span>
<span class="sd">    :param planeNorm:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">__forcePts_nx3</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>
    <span class="n">npts</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">planeNorm</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">planeNorm</span> <span class="o">=</span> <span class="n">fitPlaneToPoints</span><span class="p">(</span><span class="n">pts</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">planeNorm</span> <span class="o">=</span> <span class="n">planeNorm</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">planeNorm</span><span class="p">)</span>
    <span class="n">cPt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">pPts</span> <span class="o">=</span> <span class="n">projectPtsToPlane</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="p">(</span><span class="n">planeNorm</span><span class="p">,</span> <span class="n">cPt</span><span class="p">))</span>
    <span class="n">e1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">planeNorm</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">planeNorm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">])</span>
    <span class="n">e1</span> <span class="o">=</span> <span class="n">e1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span>
    <span class="n">e2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">planeNorm</span><span class="p">,</span> <span class="n">e1</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">e1</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">e2</span><span class="p">[:</span><span class="mi">2</span><span class="p">]])</span>
    <span class="n">xPrime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">npts</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">k1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npts</span><span class="p">):</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">pPts</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span> <span class="o">-</span> <span class="n">cPt</span>
        <span class="n">xPrime</span><span class="p">[</span><span class="n">k1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">b</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">xPrime</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">cPt</span></div>



<div class="viewcode-block" id="project3DPointsToPlanarCoordinateSystem2">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.project3DPointsToPlanarCoordinateSystem2">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">project3DPointsToPlanarCoordinateSystem2</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">planeNorm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">datumPt</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># https://stackoverflow.com/questions/26369618/getting-local-2d-coordinates-of-vertices-of-a-planar-polygon-in-3d-space</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">__forcePts_nx3</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>
    <span class="n">npts</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">if</span> <span class="n">planeNorm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">planeNorm</span> <span class="o">=</span> <span class="n">fitPlaneToPoints</span><span class="p">(</span><span class="n">pts</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">datumPt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">datumPt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">locx</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">datumPt</span>
    <span class="n">locy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">planeNorm</span><span class="p">,</span> <span class="n">locx</span><span class="p">)</span>
    <span class="n">locx</span> <span class="o">=</span> <span class="n">locx</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">locx</span><span class="p">)</span>
    <span class="n">locy</span> <span class="o">=</span> <span class="n">locy</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">locy</span><span class="p">)</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="n">datumPt</span><span class="p">,</span><span class="n">locx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="n">datumPt</span><span class="p">,</span><span class="n">locy</span><span class="p">)]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xy</span><span class="p">),</span> <span class="n">locx</span><span class="p">,</span> <span class="n">locy</span><span class="p">,</span> <span class="n">datumPt</span></div>



<div class="viewcode-block" id="convert2DPointsTo3DCoordinateSystem">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.convert2DPointsTo3DCoordinateSystem">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">convert2DPointsTo3DCoordinateSystem</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">origin</span><span class="p">):</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">])</span>
    <span class="n">xyzPrime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span> <span class="o">*</span> <span class="n">A</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">xyzPrime</span> <span class="o">+</span> <span class="n">origin</span><span class="p">))</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">circleFit2DErr</span><span class="p">(</span><span class="n">allParams</span><span class="p">,</span> <span class="n">xData</span><span class="p">,</span> <span class="n">yData</span><span class="p">):</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">([</span><span class="n">x</span> <span class="o">-</span> <span class="n">allParams</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span> <span class="o">-</span> <span class="n">allParams</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span> <span class="o">-</span> <span class="n">allParams</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xData</span><span class="p">,</span> <span class="n">yData</span><span class="p">)]</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>


<div class="viewcode-block" id="fitCircle2D">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.fitCircle2D">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">fitCircle2D</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">xGuess</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">yGuess</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">radiusGuess</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">paramsToOptimize</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xGuess</span><span class="p">,</span> <span class="n">yGuess</span><span class="p">,</span> <span class="n">radiusGuess</span><span class="p">])</span>
    <span class="n">optimizedParams</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">fmin_powell</span><span class="p">(</span><span class="n">circleFit2DErr</span><span class="p">,</span> <span class="n">paramsToOptimize</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">))</span>  <span class="c1"># @UndefinedVariable</span>
    <span class="n">xf</span> <span class="o">=</span> <span class="n">optimizedParams</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">yf</span> <span class="o">=</span> <span class="n">optimizedParams</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">rf</span> <span class="o">=</span> <span class="n">optimizedParams</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">yf</span><span class="p">,</span> <span class="n">rf</span><span class="p">)</span></div>



<div class="viewcode-block" id="fitCircleRANSAC">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.fitCircleRANSAC">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">fitCircleRANSAC</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">FRACTION_PTS_USE_FOR_CONVERGENCE</span><span class="p">,</span>
                    <span class="n">MAX_ITERATIONS</span><span class="p">,</span> <span class="n">EXCLUDE_INNERS</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">DEBUG</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param x:</span>
<span class="sd">    :param y:</span>
<span class="sd">    :param tolerance:</span>
<span class="sd">    :param FRACTION_PTS_USE_FOR_CONVERGENCE:</span>
<span class="sd">    :param MAX_ITERATIONS:</span>
<span class="sd">    :param EXCLUDE_INNERS:</span>
<span class="sd">    :param DEBUG:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">nPts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">Sbest</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">MAX_ITERATIONS</span><span class="p">:</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">Si</span><span class="p">,</span> <span class="n">Sx</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="n">id0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">nPts</span><span class="p">)</span>
        <span class="n">id1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">nPts</span><span class="p">)</span>
        <span class="n">id2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">nPts</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">id0</span> <span class="o">==</span> <span class="n">id1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">id1</span> <span class="o">==</span> <span class="n">id2</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">id0</span> <span class="o">==</span> <span class="n">id2</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">ma</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">id1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">id0</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">id1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">id0</span><span class="p">])</span>
        <span class="n">mb</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">id2</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">id1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">id2</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">id1</span><span class="p">])</span>
        <span class="n">xc</span> <span class="o">=</span> <span class="p">(</span><span class="n">ma</span> <span class="o">*</span> <span class="n">mb</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">id0</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">id2</span><span class="p">])</span> <span class="o">+</span> <span class="n">mb</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">id0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">id1</span><span class="p">])</span> <span class="o">-</span> <span class="n">ma</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">id1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">id2</span><span class="p">]))</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">mb</span> <span class="o">-</span> <span class="n">ma</span><span class="p">))</span>
        <span class="n">yc</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">ma</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">xc</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">id0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">id1</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">id0</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="n">id1</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">xc</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">id0</span><span class="p">])</span> <span class="o">**</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">yc</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">id0</span><span class="p">])</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nPts</span><span class="p">):</span>
            <span class="n">ri</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xc</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span> <span class="o">-</span> <span class="n">yc</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">EXCLUDE_INNERS</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ri</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="n">dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">ri</span> <span class="o">-</span> <span class="n">r</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dr</span> <span class="o">&lt;</span> <span class="n">tolerance</span><span class="p">:</span>
                <span class="n">Si</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Sx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k1</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Si</span><span class="p">)</span> <span class="o">/</span> <span class="n">nPts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">FRACTION_PTS_USE_FOR_CONVERGENCE</span><span class="p">:</span>
            <span class="n">Sbest</span> <span class="o">=</span> <span class="n">Si</span>
            <span class="n">xBest</span><span class="p">,</span> <span class="n">yBest</span><span class="p">,</span> <span class="n">rBest</span><span class="p">,</span> <span class="n">countBest</span> <span class="o">=</span> <span class="n">xc</span><span class="p">,</span> <span class="n">yc</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">count</span>
            <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Terminated on large Si&#39;</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Si</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">Sbest</span><span class="p">):</span>
            <span class="n">Sbest</span> <span class="o">=</span> <span class="n">Si</span>
            <span class="n">xBest</span><span class="p">,</span> <span class="n">yBest</span><span class="p">,</span> <span class="n">rBest</span><span class="p">,</span> <span class="n">countBest</span> <span class="o">=</span> <span class="n">xc</span><span class="p">,</span> <span class="n">yc</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">count</span>
    <span class="n">xf</span><span class="p">,</span> <span class="n">yf</span><span class="p">,</span> <span class="n">rf</span> <span class="o">=</span> <span class="n">fitCircle2D</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="n">Sbest</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">Sbest</span><span class="p">]))</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">xBest</span><span class="p">,</span> <span class="n">yBest</span><span class="p">,</span> <span class="n">rBest</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">xf</span><span class="p">,</span> <span class="n">yf</span><span class="p">,</span> <span class="n">rf</span></div>



<div class="viewcode-block" id="fitCircleRANSAC3D_xyz">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.fitCircleRANSAC3D_xyz">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">fitCircleRANSAC3D_xyz</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">FRACTION_PTS_USE_FOR_CONVERGENCE</span><span class="p">,</span>
                      <span class="n">MAX_ITERATIONS</span><span class="p">,</span> <span class="n">EXCLUDE_INNERS</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">DEBUG</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">xyz</span> <span class="o">=</span> <span class="n">__forcePts_nx3</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rotate to plane of best fit, then 2D fit, rotate results back to 3D</span>
<span class="sd">        Return fitted point, R, norm</span>
<span class="sd">    :param x:</span>
<span class="sd">    :param y:</span>
<span class="sd">    :param z:</span>
<span class="sd">    :param tolerance:</span>
<span class="sd">    :param FRACTION_PTS_USE_FOR_CONVERGENCE:</span>
<span class="sd">    :param MAX_ITERATIONS:</span>
<span class="sd">    :param EXCLUDE_INNERS:</span>
<span class="sd">    :param DEBUG:</span>
<span class="sd">    :return:  center, rf, normalVec</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xy</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">origin</span> <span class="o">=</span> <span class="n">project3DPointsToPlanarCoordinateSystem</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
    <span class="n">xf</span><span class="p">,</span> <span class="n">yf</span><span class="p">,</span> <span class="n">rf</span> <span class="o">=</span> <span class="n">fitCircleRANSAC</span><span class="p">(</span><span class="n">xy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">xy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">FRACTION_PTS_USE_FOR_CONVERGENCE</span><span class="p">,</span>
                                 <span class="n">MAX_ITERATIONS</span><span class="p">,</span> <span class="n">EXCLUDE_INNERS</span><span class="p">,</span> <span class="n">DEBUG</span><span class="p">)</span>
    <span class="n">xyzf</span> <span class="o">=</span> <span class="n">convert2DPointsTo3DCoordinateSystem</span><span class="p">([</span><span class="n">xf</span><span class="p">,</span> <span class="n">yf</span><span class="p">],</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">origin</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">xyzf</span><span class="p">,</span> <span class="n">rf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">)</span></div>



<div class="viewcode-block" id="fit_ellipse_2d">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.fit_ellipse_2d">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">fit_ellipse_2d</span><span class="p">(</span><span class="n">points2d</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fit an ellipse to 2D points.</span>
<span class="sd">    :param points2d: 2D points to fit ellipse to</span>
<span class="sd">    :return: ellipse parameters (a, b, c, d, e, f) where ax^2 + bxy + cy^2 + dx + ey + f = 0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">points2d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">][:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">points2d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">][:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">D</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">E</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">S</span><span class="p">)</span> <span class="o">@</span> <span class="n">C</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">V</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">E</span><span class="p">))]</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">a</span><span class="p">)</span></div>



<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<div class="viewcode-block" id="fit_ellipse_3d">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.fit_ellipse_3d">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">fit_ellipse_3d</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fit an ellipse to 3D points that approximately lie on a plane.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    points : (N,3) array_like</span>
<span class="sd">        Input 3D coordinates.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : dict</span>
<span class="sd">        {</span>
<span class="sd">            &#39;center_3d&#39;   : np.ndarray (3,)  - ellipse center in 3D</span>
<span class="sd">            &#39;normal&#39;      : np.ndarray (3,)  - unit normal of plane</span>
<span class="sd">            &#39;axes&#39;        : np.ndarray (2,)  - [major, minor] axes lengths</span>
<span class="sd">            &#39;angle&#39;       : float            - rotation angle (radians) within plane</span>
<span class="sd">            &#39;u&#39;           : np.ndarray (3,)  - in-plane x-axis</span>
<span class="sd">            &#39;v&#39;           : np.ndarray (3,)  - in-plane y-axis</span>
<span class="sd">            &#39;points_3d&#39;   : (N,3) np.ndarray - fitted ellipse points in 3D</span>
<span class="sd">        }</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">pts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Input must be Nx3 array&quot;</span>

    <span class="c1"># Fit plane to points </span>
    <span class="n">centroid</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">U</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">Vt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">pts</span> <span class="o">-</span> <span class="n">centroid</span><span class="p">)</span>
    <span class="n">normal</span> <span class="o">=</span> <span class="n">Vt</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">Vt</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># Project to 2D coordinates on plane </span>
    <span class="n">ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">normal</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">0.9</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">ref</span><span class="p">);</span> <span class="n">u</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
    <span class="n">rel</span> <span class="o">=</span> <span class="n">pts</span> <span class="o">-</span> <span class="n">centroid</span>
    <span class="n">x2d</span> <span class="o">=</span> <span class="n">rel</span> <span class="o">@</span> <span class="n">u</span>
    <span class="n">y2d</span> <span class="o">=</span> <span class="n">rel</span> <span class="o">@</span> <span class="n">v</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">x2d</span><span class="p">,</span> <span class="n">y2d</span><span class="p">))</span>

    <span class="c1"># Fit 2D ellipse (Halir &amp; Flusser, 1998) </span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][:,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][:,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">,</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">D</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">E</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">S</span><span class="p">)</span> <span class="o">@</span> <span class="n">C</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">E</span><span class="p">))])</span>

    <span class="c1"># Extract geometric ellipse parameters </span>
    <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">a0</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">num</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">b</span> <span class="o">-</span> <span class="n">a0</span> <span class="o">*</span> <span class="n">c</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">d</span> <span class="o">-</span> <span class="n">b</span> <span class="o">*</span> <span class="n">f</span><span class="p">)</span> <span class="o">/</span> <span class="n">num</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="p">(</span><span class="n">a0</span> <span class="o">*</span> <span class="n">f</span> <span class="o">-</span> <span class="n">b</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span> <span class="o">/</span> <span class="n">num</span>
    <span class="n">up</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">a0</span> <span class="o">*</span> <span class="n">f</span> <span class="o">*</span> <span class="n">f</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">d</span> <span class="o">*</span> <span class="n">d</span> <span class="o">+</span> <span class="n">g</span> <span class="o">*</span> <span class="n">b</span> <span class="o">*</span> <span class="n">b</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">b</span> <span class="o">*</span> <span class="n">d</span> <span class="o">*</span> <span class="n">f</span> <span class="o">-</span> <span class="n">a0</span> <span class="o">*</span> <span class="n">c</span> <span class="o">*</span> <span class="n">g</span><span class="p">)</span>
    <span class="n">down1</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">b</span> <span class="o">-</span> <span class="n">a0</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span> <span class="o">*</span> <span class="p">(((</span><span class="n">c</span> <span class="o">-</span> <span class="n">a0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">b</span> <span class="o">*</span> <span class="n">b</span> <span class="o">/</span> <span class="p">((</span><span class="n">a0</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="n">a0</span><span class="p">))</span>
    <span class="n">down2</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">b</span> <span class="o">-</span> <span class="n">a0</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span> <span class="o">*</span> <span class="p">(((</span><span class="n">a0</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">b</span> <span class="o">*</span> <span class="n">b</span> <span class="o">/</span> <span class="p">((</span><span class="n">a0</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="n">a0</span><span class="p">))</span>
    <span class="n">a_len</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">up</span> <span class="o">/</span> <span class="n">down1</span><span class="p">))</span>
    <span class="n">b_len</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">up</span> <span class="o">/</span> <span class="n">down2</span><span class="p">))</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">b</span> <span class="o">/</span> <span class="p">(</span><span class="n">a0</span> <span class="o">-</span> <span class="n">c</span><span class="p">))</span>
    <span class="n">center2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">])</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a_len</span><span class="p">,</span> <span class="n">b_len</span><span class="p">])</span>

    <span class="c1"># Map ellipse back to 3D </span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)]])</span>
    <span class="n">ellipse_2d</span> <span class="o">=</span> <span class="n">R</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)))</span> <span class="o">+</span> <span class="n">center2d</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">ellipse_3d</span> <span class="o">=</span> <span class="n">centroid</span> <span class="o">+</span> <span class="n">ellipse_2d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span> <span class="o">+</span> <span class="n">ellipse_2d</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;center_3d&quot;</span><span class="p">:</span> <span class="n">centroid</span> <span class="o">+</span> <span class="n">center2d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span> <span class="o">+</span> <span class="n">center2d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span><span class="p">,</span>
        <span class="s2">&quot;normal&quot;</span><span class="p">:</span> <span class="n">normal</span><span class="p">,</span>
        <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="n">axes</span><span class="p">,</span>
        <span class="s2">&quot;angle&quot;</span><span class="p">:</span> <span class="n">angle</span><span class="p">,</span>
        <span class="s2">&quot;u&quot;</span><span class="p">:</span> <span class="n">u</span><span class="p">,</span>
        <span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="n">v</span><span class="p">,</span>
        <span class="s2">&quot;points_3d&quot;</span><span class="p">:</span> <span class="n">ellipse_3d</span>
    <span class="p">}</span></div>



<span class="c1"># ======================================================================================================================</span>
<span class="c1">#           GEOMETRY</span>
<span class="c1"># ======================================================================================================================</span>
<div class="viewcode-block" id="buildCircle3D">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.buildCircle3D">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">buildCircle3D</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">nPts</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param X: centre of circle</span>
<span class="sd">    :param N: normal of circle</span>
<span class="sd">    :param R: radius of circle</span>
<span class="sd">    :param nPts: number of points to place around circumference [50]</span>
<span class="sd">    :return: xyz of points on circumference of circle</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">### Let W = (w0,w1,w2). Choose U = (u0,u1,u2) and V = (v0,v1,v2) using</span>
    <span class="n">normalVec</span> <span class="o">=</span> <span class="n">N</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">normalVec</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">normalVec</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">normalVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">normalVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">normalVec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">normalVec</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">u0</span> <span class="o">=</span> <span class="o">-</span><span class="n">normalVec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">factor</span>
        <span class="n">u1</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">u2</span> <span class="o">=</span> <span class="n">normalVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">factor</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">normalVec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">normalVec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">normalVec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">normalVec</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">u0</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">u1</span> <span class="o">=</span> <span class="n">normalVec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">factor</span>
        <span class="n">u2</span> <span class="o">=</span> <span class="o">-</span><span class="n">normalVec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">factor</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">u0</span><span class="p">,</span> <span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">])</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">normalVec</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
    <span class="c1">### X(t) = C + (r*cos(t))*U + (r*sin(t))*V ##</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">dtheta</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">nPts</span>
    <span class="n">fc_circle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="n">nPts</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nPts</span><span class="p">):</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span> <span class="o">+</span> <span class="n">dtheta</span>
        <span class="n">fc_circle</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">+</span> <span class="p">(</span><span class="n">R</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="o">*</span> <span class="n">u</span> <span class="o">+</span> <span class="p">(</span><span class="n">R</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="o">*</span> <span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="k">return</span> <span class="n">fc_circle</span><span class="o">.</span><span class="n">T</span></div>



<div class="viewcode-block" id="fitPlaneToPointCloud_RANSAC">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.fitPlaneToPointCloud_RANSAC">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">fitPlaneToPointCloud_RANSAC</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">planeSearchDist_abs</span><span class="p">,</span> <span class="n">planeFractionToInclude</span><span class="p">,</span> <span class="n">max_iterations</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">VERBOSE</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fits a plane to a 3D point cloud using RANSAC.</span>
<span class="sd">        Choose random point</span>
<span class="sd">        Take next two closest points - calc plane</span>
<span class="sd">        Test number of points within planeSearchDist_abs </span>
<span class="sd">            If &gt; planeFractionToInclude</span>
<span class="sd">                test RMSE vs best</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - pts: A numpy array of shape (N, 3) representing the 3D point cloud.</span>
<span class="sd">    - planeSearchDist_abs: The absolute distance to search for points for plane RMSE calc.</span>
<span class="sd">    - planePercentageToInclude: The fraction of points required to be part of plane.</span>
<span class="sd">    - max_iterations: The maximum number of iterations for the RANSAC algorithm (default=1000).</span>
<span class="sd">    - random_state: Random state for reproducibility (default=None).</span>

<span class="sd">    Returns:</span>
<span class="sd">    - plane_normal: A numpy array representing the normal vector of the fitted plane.</span>
<span class="sd">    - plane_center: A numpy array representing a point on the fitted plane.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">best_plane_normal</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">best_plane_center</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">best_num_inliers</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">total_points</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">target_inliers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">total_points</span> <span class="o">*</span> <span class="n">planeFractionToInclude</span><span class="p">)</span>
    <span class="n">rndIDs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">total_points</span><span class="p">))</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">rndIDs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Have </span><span class="si">{</span><span class="n">total_points</span><span class="si">}</span><span class="s2"> total_points. Target inliers=</span><span class="si">{</span><span class="n">target_inliers</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">total_points</span><span class="p">,</span> <span class="n">max_iterations</span><span class="p">)):</span>
        <span class="c1"># Randomly sample point - get closest 2 neighbours</span>
        <span class="n">rndID</span> <span class="o">=</span> <span class="n">rndIDs</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span>
        <span class="n">idists</span> <span class="o">=</span> <span class="n">distPointPoints</span><span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="n">rndID</span><span class="p">],</span> <span class="n">pts</span><span class="p">)</span>
        <span class="n">sampleIDs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">idists</span><span class="p">)[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">]]</span>
        <span class="n">samplePts</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">sampleIDs</span><span class="p">]</span>

        <span class="c1"># Calculate plane parameters using these points</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="n">samplePts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">samplePts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="n">samplePts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">samplePts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">plane_normal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
        <span class="n">plane_normal</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">plane_normal</span><span class="p">)</span>
        <span class="n">plane_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">samplePts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Calculate distances from points to plane</span>
        <span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">pts</span> <span class="o">-</span> <span class="n">plane_center</span><span class="p">,</span> <span class="n">plane_normal</span><span class="p">))</span>

        <span class="c1"># Count inliers</span>
        <span class="n">inlier_mask</span> <span class="o">=</span> <span class="n">distances</span> <span class="o">&lt;</span> <span class="n">planeSearchDist_abs</span>
        <span class="n">num_inliers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">inlier_mask</span><span class="p">)</span>
        <span class="c1"># Update best model if necessary</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">best_plane_normal</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">((</span><span class="n">num_inliers</span> <span class="o">&gt;=</span> <span class="n">target_inliers</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">num_inliers</span> <span class="o">&gt;</span> <span class="n">best_num_inliers</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Update best num_inliers = </span><span class="si">{</span><span class="n">num_inliers</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">num_inliers</span><span class="o">/</span><span class="n">total_points</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">%). best_plane_normal=</span><span class="si">{</span><span class="n">plane_normal</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">best_plane_normal</span> <span class="o">=</span> <span class="n">plane_normal</span>
            <span class="n">best_plane_center</span> <span class="o">=</span> <span class="n">plane_center</span>
            <span class="n">best_num_inliers</span> <span class="o">=</span> <span class="n">num_inliers</span>
    <span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;It:</span><span class="si">{</span><span class="n">k1</span><span class="si">}</span><span class="s2"> - best plane norm = </span><span class="si">{</span><span class="n">best_plane_normal</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">best_plane_normal</span><span class="p">,</span> <span class="n">best_plane_center</span></div>



<span class="c1"># ======================================================================================================================</span>
<span class="c1"># def findCylinderAxis(point_cloud):</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     Finds the main axis of a cylindrical point cloud.</span>
    
<span class="c1">#     :param point_cloud: Nx3 numpy array where N is the number of points and each row is (x, y, z).</span>
<span class="c1">#     :return: A unit vector defining the main axis of the cylinder.</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     from sklearn.decomposition import PCA</span>
<span class="c1">#     point_cloud_centered = point_cloud - np.mean(point_cloud, axis=0)</span>
<span class="c1">#     pca = PCA(n_components=3)</span>
<span class="c1">#     pca.fit(point_cloud_centered)</span>
<span class="c1">#     main_axis = pca.components_[0]</span>
<span class="c1">#     return main_axis / np.linalg.norm(main_axis)</span>


<span class="c1"># ======================================================================================================================</span>
<span class="c1"># ======================================================================================================================</span>

<div class="viewcode-block" id="deg2rad">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.deg2rad">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">deg2rad</span><span class="p">(</span><span class="n">deg</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">deg</span> <span class="o">/</span> <span class="mf">180.0</span></div>



<div class="viewcode-block" id="rad2deg">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.rad2deg">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">rad2deg</span><span class="p">(</span><span class="n">rad</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">180.0</span> <span class="o">*</span> <span class="n">rad</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span></div>



<div class="viewcode-block" id="rotateArray">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.rotateArray">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">rotateArray</span><span class="p">(</span><span class="n">velArray</span><span class="p">,</span> <span class="n">rotationMatrix</span><span class="p">):</span>
    <span class="n">vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">velArray</span><span class="p">)</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="n">vel</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">if</span> <span class="n">dims</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;ERROR ARRAY IS WRONG SIZE&#39;</span><span class="p">)</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">dims</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">newDims</span> <span class="o">=</span> <span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">vel</span><span class="p">,</span> <span class="n">newDims</span><span class="p">)</span>
    <span class="n">velM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">vel</span><span class="p">)</span>
    <span class="n">velM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">velM</span><span class="p">)</span>
    <span class="n">velMR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">pts</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pts</span><span class="p">):</span>
        <span class="n">velMR</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">rotationMatrix</span> <span class="o">*</span> <span class="n">velM</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
    <span class="n">velOut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">velMR</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">velOut</span></div>



<div class="viewcode-block" id="rotationMatrixFromThreeAngles">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.rotationMatrixFromThreeAngles">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">rotationMatrixFromThreeAngles</span><span class="p">(</span><span class="n">xTheta</span><span class="p">,</span> <span class="n">yTheta</span><span class="p">,</span> <span class="n">zTheta</span><span class="p">):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">xTheta</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">xTheta</span><span class="p">)],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">xTheta</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">xTheta</span><span class="p">)]])</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">yTheta</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">yTheta</span><span class="p">)],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">yTheta</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">yTheta</span><span class="p">)]])</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">zTheta</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">zTheta</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">zTheta</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">zTheta</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">Y</span><span class="p">),</span> <span class="n">X</span><span class="p">)</span></div>



<div class="viewcode-block" id="getClosestInSortedList">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.getClosestInSortedList">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">getClosestInSortedList</span><span class="p">(</span><span class="n">listIn</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">INCREASEING</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">k1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">listIn</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">INCREASEING</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">listIn</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">ref</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">k1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">listIn</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ref</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">k1</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">listIn</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span></div>



<div class="viewcode-block" id="getIdOfClosestFloat">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.getIdOfClosestFloat">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">getIdOfClosestFloat</span><span class="p">(</span><span class="n">listIn</span><span class="p">,</span> <span class="n">ref</span><span class="p">):</span>
    <span class="n">dd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">listIn</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">dd</span><span class="p">))</span></div>



<div class="viewcode-block" id="polar2Cart">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.polar2Cart">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">polar2Cart</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">theta</span><span class="p">):</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">polar2z</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">z</span><span class="p">)</span></div>



<div class="viewcode-block" id="polar2z">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.polar2z">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">polar2z</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">theta</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">theta</span> <span class="p">)</span></div>



<div class="viewcode-block" id="z2Polar">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.z2Polar">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">z2Polar</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span> <span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="p">)</span></div>



<div class="viewcode-block" id="cart2Polar">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.cart2Polar">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cart2Polar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">y</span>
    <span class="k">return</span> <span class="n">z2Polar</span><span class="p">(</span><span class="n">z</span><span class="p">)</span></div>



<div class="viewcode-block" id="unit_vector">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.unit_vector">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">unit_vector</span><span class="p">(</span><span class="n">vector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Returns the unit vector of the vector.  &quot;&quot;&quot;</span>
    <span class="n">VM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">VM</span> <span class="o">&lt;</span> <span class="mf">0.0000000000001</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">vector</span> <span class="o">/</span> <span class="n">VM</span></div>



<div class="viewcode-block" id="vecFromPtToLine">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.vecFromPtToLine">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">vecFromPtToLine</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">ptOnLine</span><span class="p">,</span> <span class="n">lineNorm</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">ptOnLine</span> <span class="o">-</span> <span class="n">pt</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ptOnLine</span> <span class="o">-</span> <span class="n">pt</span><span class="p">,</span> <span class="n">lineNorm</span><span class="p">)</span> <span class="o">*</span> <span class="n">lineNorm</span><span class="p">)</span></div>



<div class="viewcode-block" id="fcdot">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.fcdot">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">fcdot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; dot product of two lists of vecs&quot;&quot;&quot;</span>
    <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">__forcePts_nx3</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">__forcePts_nx3</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)])</span></div>



<div class="viewcode-block" id="cosineDifferenceBetweenTwoMats">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.cosineDifferenceBetweenTwoMats">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cosineDifferenceBetweenTwoMats</span><span class="p">(</span><span class="n">mA</span><span class="p">,</span> <span class="n">mB</span><span class="p">):</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="n">mA</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">matDiff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dims</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">matDiff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">angleBetween2Vec</span><span class="p">(</span><span class="n">mA</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="n">mB</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">matDiff</span></div>



<div class="viewcode-block" id="getVectorComponentAlongRefVec">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.getVectorComponentAlongRefVec">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">getVectorComponentAlongRefVec</span><span class="p">(</span><span class="n">velVec</span><span class="p">,</span> <span class="n">refVec</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Returns vec parallel to refVec&quot;&quot;&quot;</span>
    <span class="n">refVec_U</span> <span class="o">=</span> <span class="n">refVec</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">refVec</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">velVec</span><span class="p">,</span> <span class="n">refVec_U</span><span class="p">)</span> <span class="o">*</span> <span class="n">refVec_U</span></div>



<div class="viewcode-block" id="getVectorComponentAlongRefVec_Mag">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.getVectorComponentAlongRefVec_Mag">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">getVectorComponentAlongRefVec_Mag</span><span class="p">(</span><span class="n">velVec</span><span class="p">,</span> <span class="n">refVec</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Returns magnitude (signed) of vec parallel to refVec&quot;&quot;&quot;</span>
    <span class="n">refVec_U</span> <span class="o">=</span> <span class="n">refVec</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">refVec</span><span class="p">)</span>
    <span class="n">llv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">velVec</span><span class="p">,</span> <span class="n">refVec_U</span><span class="p">)</span> <span class="o">*</span> <span class="n">refVec_U</span>
    <span class="n">llvM</span> <span class="o">=</span> <span class="n">vectorMagnitudes</span><span class="p">(</span><span class="n">llv</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">areVecsConsistent</span><span class="p">(</span><span class="n">llv</span><span class="p">,</span> <span class="n">refVec</span><span class="p">):</span>
        <span class="k">return</span>  <span class="n">llvM</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span>  <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">llvM</span></div>



<div class="viewcode-block" id="getVectorComponentNormalToRefVec">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.getVectorComponentNormalToRefVec">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">getVectorComponentNormalToRefVec</span><span class="p">(</span><span class="n">velVec</span><span class="p">,</span> <span class="n">refVec</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Returns vec component in plane normal to refVec&quot;&quot;&quot;</span>
    <span class="n">vel_t</span> <span class="o">=</span> <span class="n">getVectorComponentAlongRefVec</span><span class="p">(</span><span class="n">velVec</span><span class="p">,</span> <span class="n">refVec</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">velVec</span> <span class="o">-</span> <span class="n">vel_t</span></div>



<div class="viewcode-block" id="closeCurve">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.closeCurve">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">closeCurve</span><span class="p">(</span><span class="n">xyz</span><span class="p">):</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">pts</span><span class="p">,</span> <span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">pts</span></div>



<div class="viewcode-block" id="splinePoints">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.splinePoints">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">splinePoints</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">nSplinePts</span><span class="p">,</span> <span class="n">periodic</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">RETURN_NUMPY</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">smooth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">derivitive</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     returns list, shape (3, n), unless ask for numpy then transpose</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">periodic</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">smooth</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">pts</span><span class="p">,</span> <span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">weights</span><span class="p">,</span> <span class="n">weights</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="n">tck</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">splprep</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">smooth</span><span class="p">,</span> <span class="n">per</span><span class="o">=</span><span class="n">periodic</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
    <span class="n">uu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">u</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">nSplinePts</span><span class="p">)</span>
    <span class="n">newPts</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">splev</span><span class="p">(</span><span class="n">uu</span><span class="p">,</span> <span class="n">tck</span><span class="p">,</span> <span class="n">der</span><span class="o">=</span><span class="n">derivitive</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">RETURN_NUMPY</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">newPts</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="k">return</span> <span class="n">newPts</span></div>



<div class="viewcode-block" id="splineFunction">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.splineFunction">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">splineFunction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">kind</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">)</span></div>



<div class="viewcode-block" id="splineXY">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.splineXY">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">splineXY</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">nPts</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">per</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Input : x, y, numPts</span>
<span class="sd">        Output : X, Y</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">per</span><span class="p">:</span>
        <span class="n">xp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">splineFunction</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">kind</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">splineFunction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">kind</span><span class="p">)</span>
    <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">nPts</span><span class="p">)</span>
    <span class="n">yy</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span></div>



<div class="viewcode-block" id="splineCurve">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.splineCurve">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">splineCurve</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">nPts</span><span class="p">,</span> <span class="n">interpolation_method</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Spline is 2D (i.e x not always increasing)</span>

<span class="sd">    Args:</span>
<span class="sd">        x (np.array): x array</span>
<span class="sd">        y (np.array): y array</span>
<span class="sd">        interpolation_methods (str, optional): of &#39;slinear&#39;, &#39;quadratic&#39;, &#39;cubic&#39;]. Defaults to &#39;cubic&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span> <span class="p">))</span> <span class="p">)</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">distance</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nPts</span><span class="p">)</span>
    <span class="n">interpolator</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">interpolation_method</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">interpolator</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">T</span></div>



<div class="viewcode-block" id="getMaxsMinsInflections">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.getMaxsMinsInflections">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">getMaxsMinsInflections</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple extrema finder</span>
<span class="sd">    :param X: 1D array</span>
<span class="sd">    :return: linst of maxima, list of minima, lint of inflections</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.signal</span><span class="w"> </span><span class="kn">import</span> <span class="n">argrelextrema</span>
    <span class="n">gg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">argrelextrema</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">greater</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> \
           <span class="n">argrelextrema</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> \
           <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">argrelextrema</span><span class="p">(</span><span class="n">gg</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">greater</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">argrelextrema</span><span class="p">(</span><span class="n">gg</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span></div>



<div class="viewcode-block" id="sigmoidFunction">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.sigmoidFunction">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">sigmoidFunction</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">gradient</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    calculate sigmoid function of input value (np array)</span>
<span class="sd">    center is what to adjust input by so zero centered</span>
<span class="sd">    gradient is used to adjust slope of sigmoid -</span>
<span class="sd">        (adjusted) values above this number will have output &gt; 0.72</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">valueT</span> <span class="o">=</span> <span class="n">value</span> <span class="o">-</span> <span class="n">center</span>
    <span class="n">output</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">valueT</span> <span class="o">/</span> <span class="n">gradient</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">output</span></div>



<div class="viewcode-block" id="extractContinuousSegFromPeriodic">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.extractContinuousSegFromPeriodic">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">extractContinuousSegFromPeriodic</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">IDstart</span><span class="p">,</span> <span class="n">IDend</span><span class="p">,</span> <span class="n">TIME</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Take a sub section from an array, assuming periodic (to deal with subsection going beyond bounds)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">TIME</span><span class="p">:</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">xx</span><span class="p">))</span>
        <span class="n">tN</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">xx3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">xx</span><span class="p">,</span> <span class="n">xx</span><span class="o">+</span><span class="n">delta</span><span class="o">+</span><span class="n">tN</span><span class="p">,</span> <span class="n">xx</span><span class="o">+</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">delta</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">tN</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xx3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">xx</span><span class="p">,</span><span class="n">xx</span><span class="p">,</span><span class="n">xx</span><span class="p">))</span>
    <span class="n">IDstart</span> <span class="o">=</span> <span class="n">IDstart</span> <span class="o">+</span> <span class="n">N</span>
    <span class="n">IDend</span> <span class="o">=</span> <span class="n">IDend</span> <span class="o">+</span> <span class="n">N</span>
    <span class="n">xxOut</span> <span class="o">=</span> <span class="n">xx3</span><span class="p">[</span><span class="n">IDstart</span><span class="p">:</span><span class="n">IDend</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">TIME</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">xxOut</span> <span class="o">-</span> <span class="n">tN</span> <span class="o">-</span> <span class="n">delta</span>
    <span class="k">return</span> <span class="n">xxOut</span></div>



<div class="viewcode-block" id="fitGaussianToData">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.fitGaussianToData">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">fitGaussianToData</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">):</span>
    <span class="n">popt</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">curve_fit</span><span class="p">(</span><span class="n">gaussianFunction</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">)</span>
    <span class="n">center</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">popt</span>
    <span class="c1"># &#39;x&#39;: xSub, &#39;y&#39;: ftk.gaussianFunction(xSub, *popt)</span>
    <span class="k">return</span> <span class="n">center</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span></div>



<div class="viewcode-block" id="gaussianFunction">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.gaussianFunction">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">gaussianFunction</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    calculate gaussian function of input value (np array)</span>
<span class="sd">    center is what to adjust input by so zero centered</span>
<span class="sd">    width is standard dev of bell curve</span>
<span class="sd">    height is height of peak</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">valueT</span> <span class="o">=</span> <span class="n">value</span> <span class="o">-</span> <span class="n">center</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">height</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">valueT</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">width</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">output</span></div>



<div class="viewcode-block" id="calculate_signed_area_2d">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.calculate_signed_area_2d">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">calculate_signed_area_2d</span><span class="p">(</span><span class="n">points_2d</span><span class="p">):</span>
    <span class="c1"># Use the shoelace formula to calculate the signed area of the 2D points</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">points_2d</span><span class="p">)</span>
    <span class="n">area</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">points_2d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">points_2d</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">]</span>
        <span class="n">area</span> <span class="o">+=</span> <span class="p">(</span><span class="n">x1</span> <span class="o">*</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span> <span class="o">*</span> <span class="n">x2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">area</span> <span class="o">/</span> <span class="mf">2.0</span></div>



<div class="viewcode-block" id="isClosedPolygonClockwise">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.isClosedPolygonClockwise">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">isClosedPolygonClockwise</span><span class="p">(</span><span class="n">xyzIn</span><span class="p">,</span> <span class="n">refVec</span><span class="p">):</span>
    <span class="c1"># Calculate the centroid to use as origin</span>
    <span class="n">xyP</span> <span class="o">=</span> <span class="n">project3DPointsToPlanarCoordinateSystem</span><span class="p">(</span><span class="n">xyzIn</span><span class="p">,</span> <span class="n">refVec</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># Calculate the signed area</span>
    <span class="n">signed_area</span> <span class="o">=</span> <span class="n">calculate_signed_area_2d</span><span class="p">(</span><span class="n">xyP</span><span class="p">)</span>
    <span class="c1"># If the signed area is negative, it&#39;s clockwise; otherwise, it&#39;s counterclockwise</span>
    <span class="k">return</span> <span class="n">signed_area</span> <span class="o">&lt;</span> <span class="mi">0</span></div>



<div class="viewcode-block" id="ensureClosedPolyIsClockwise">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.ensureClosedPolyIsClockwise">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">ensureClosedPolyIsClockwise</span><span class="p">(</span><span class="n">xzyIn</span><span class="p">,</span> <span class="n">refVec</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">isClosedPolygonClockwise</span><span class="p">(</span><span class="n">xzyIn</span><span class="p">,</span> <span class="n">refVec</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">xzyIn</span>
    <span class="k">return</span> <span class="n">xzyIn</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="setFirstPtOfPolygon">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.setFirstPtOfPolygon">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">setFirstPtOfPolygon</span><span class="p">(</span><span class="n">xyzIn</span><span class="p">,</span> <span class="n">refVec</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reorder the points of a polygon so that the first point is closest to the refVec (e.g. &#39;12 o&#39;clock&#39; position).</span>

<span class="sd">    This function assumes the polygon is planar and reorders the points so that the first point</span>
<span class="sd">    is the one closest to the end of a vector starting from the polygon&#39;s center point</span>
<span class="sd">    and pointing in the direction of the reference vector.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    xyzIn (array-like): Input points of the polygon.</span>
<span class="sd">    refVec (array-like): Reference vector indicating the &#39;12 o&#39;clock&#39; direction.</span>

<span class="sd">    Returns:</span>
<span class="sd">    numpy.ndarray: Reordered points of the polygon.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xyzIn</span><span class="p">)</span>
    <span class="n">refVec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">refVec</span><span class="p">)</span>
    <span class="n">nPts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>
    <span class="n">cp</span> <span class="o">=</span> <span class="n">getPolygonCenterPoint</span><span class="p">(</span><span class="n">xyzIn</span><span class="p">)</span>
    <span class="n">meanDiameter</span> <span class="o">=</span> <span class="n">getPolygonMeanDiameter</span><span class="p">(</span><span class="n">xyzIn</span><span class="p">)</span>
    <span class="n">vectorEnd</span> <span class="o">=</span> <span class="n">cp</span> <span class="o">+</span> <span class="n">meanDiameter</span> <span class="o">/</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">refVec</span>
    <span class="n">closestPtIndex</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ptToLineDist</span> <span class="o">=</span> <span class="n">distTwoPoints</span><span class="p">(</span><span class="n">vectorEnd</span><span class="p">,</span> <span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nPts</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">iDist</span> <span class="o">=</span> <span class="n">distTwoPoints</span><span class="p">(</span><span class="n">vectorEnd</span><span class="p">,</span> <span class="n">pts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">iDist</span> <span class="o">&lt;</span> <span class="n">ptToLineDist</span><span class="p">):</span>
            <span class="n">closestPtIndex</span><span class="p">,</span> <span class="n">ptToLineDist</span> <span class="o">=</span> <span class="n">i</span><span class="p">,</span> <span class="n">iDist</span>
    <span class="k">return</span> <span class="n">reorderPointsStatingAti</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">closestPtIndex</span><span class="p">)</span></div>



<div class="viewcode-block" id="reorderPointsStartClosestToX">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.reorderPointsStartClosestToX">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">reorderPointsStartClosestToX</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">getIDOfClosestPoint</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">pts</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">reorderPointsStatingAti</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">ID</span><span class="p">)</span></div>



<div class="viewcode-block" id="reorderPointsStatingAti">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.reorderPointsStatingAti">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">reorderPointsStatingAti</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">__forcePts_nx3</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>
    <span class="n">ptsOut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">pts</span><span class="p">[</span><span class="n">i</span><span class="p">:][:],</span> <span class="n">pts</span><span class="p">[:</span><span class="n">i</span><span class="p">][:]))</span>
    <span class="k">return</span> <span class="n">ptsOut</span></div>



<div class="viewcode-block" id="sortPointsByClosest_RETURNIDs">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.sortPointsByClosest_RETURNIDs">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">sortPointsByClosest_RETURNIDs</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">refX0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Grab closest to refX0, grab next closest, keep going in that direction</span>
<span class="sd">     RETURN IDs &quot;&quot;&quot;</span>
    <span class="n">X</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xyz</span><span class="p">]</span>
    <span class="n">X2</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xyz</span><span class="p">]</span>
    <span class="n">IDs</span> <span class="o">=</span> <span class="p">[</span><span class="n">getIDOfClosestPoint</span><span class="p">(</span><span class="n">refX0</span><span class="p">,</span> <span class="n">X</span><span class="p">)]</span>
    <span class="n">X2</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">IDs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nextID</span> <span class="o">=</span> <span class="n">getIdOfPointClosestToX</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">IDs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="n">X2</span><span class="p">)</span>
            <span class="n">IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">X2</span><span class="p">[</span><span class="n">nextID</span><span class="p">]))</span>
            <span class="n">X2</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">nextID</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">IDs</span></div>



<div class="viewcode-block" id="sortPointsByClosest">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.sortPointsByClosest">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">sortPointsByClosest</span><span class="p">(</span><span class="n">xyz</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Grab first, grab closest, keep going in that direction &quot;&quot;&quot;</span>
    <span class="n">X</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xyz</span><span class="p">]</span>
    <span class="n">ptsOut</span> <span class="o">=</span> <span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nextID</span> <span class="o">=</span> <span class="n">getIdOfPointClosestToX</span><span class="p">(</span><span class="n">ptsOut</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">X</span><span class="p">)</span>
            <span class="n">ptsOut</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">nextID</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ptsOut</span><span class="p">)</span></div>



<div class="viewcode-block" id="cumulativeDistanceAlongLine">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.cumulativeDistanceAlongLine">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cumulativeDistanceAlongLine</span><span class="p">(</span><span class="n">xyzPts</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Return array same len as input with sum of dists</span>
<span class="sd">        [0.0, dist-0to1, dist-0to1to2, ...] &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xyzPts</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">dists</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span>
                 <span class="n">p2</span><span class="p">,</span> <span class="n">p1</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xyzPts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">xyzPts</span><span class="p">[</span><span class="mi">1</span><span class="p">:])]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xyzPts</span> <span class="o">=</span> <span class="n">__forcePts_nx3</span><span class="p">(</span><span class="n">xyzPts</span><span class="p">)</span>
        <span class="n">dists</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span>
                 <span class="n">p2</span><span class="p">,</span> <span class="n">p1</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xyzPts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">xyzPts</span><span class="p">[</span><span class="mi">1</span><span class="p">:])]</span>
    <span class="n">dists</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">dists</span><span class="p">)</span></div>



<div class="viewcode-block" id="getIdOfPointClosestToX">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.getIdOfPointClosestToX">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">getIdOfPointClosestToX</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">xyz</span><span class="p">):</span>
    <span class="n">diffs</span> <span class="o">=</span> <span class="n">distPointPoints</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">xyz</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">diffs</span><span class="p">)</span></div>



<div class="viewcode-block" id="getPolygonMeanRadius">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.getPolygonMeanRadius">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">getPolygonMeanRadius</span><span class="p">(</span><span class="n">xyzIn</span><span class="p">,</span> <span class="n">EXCLUDE_CENTER</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xyzIn</span><span class="p">)</span>
    <span class="n">nPts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>
    <span class="n">cp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">allR</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nPts</span><span class="p">):</span>
        <span class="n">allR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">distPointPoints</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">pts</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">EXCLUDE_CENTER</span><span class="p">:</span>
        <span class="n">allR</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">allR</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">allR</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">allR</span><span class="p">)</span></div>



<div class="viewcode-block" id="getPolygonMeanDiameter">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.getPolygonMeanDiameter">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">getPolygonMeanDiameter</span><span class="p">(</span><span class="n">xyzIn</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">getPolygonMeanRadius</span><span class="p">(</span><span class="n">xyzIn</span><span class="p">)</span> <span class="o">*</span> <span class="mf">2.0</span></div>



<div class="viewcode-block" id="getPolygonCenterPoint">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.getPolygonCenterPoint">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">getPolygonCenterPoint</span><span class="p">(</span><span class="n">xyzIn</span><span class="p">):</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xyzIn</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>



<div class="viewcode-block" id="lineMagnitude">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.lineMagnitude">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">lineMagnitude</span><span class="p">(</span><span class="n">lineStartxyz</span><span class="p">,</span> <span class="n">lineEndxyz</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lineStartxyz</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">lineMagnitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">((</span><span class="n">lineEndxyz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">lineStartxyz</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">((</span><span class="n">lineEndxyz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">lineStartxyz</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">((</span><span class="n">lineEndxyz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">lineStartxyz</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lineMagnitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">((</span><span class="n">lineEndxyz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">lineStartxyz</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">((</span><span class="n">lineEndxyz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">lineStartxyz</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">lineMagnitude</span></div>



<div class="viewcode-block" id="distancePointToLineSegPerpendicular">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.distancePointToLineSegPerpendicular">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">distancePointToLineSegPerpendicular</span><span class="p">(</span><span class="n">lineStartxyz</span><span class="p">,</span> <span class="n">lineEndxyz</span><span class="p">,</span> <span class="n">ptxyz</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">lineEndxyz</span><span class="o">-</span><span class="n">lineStartxyz</span><span class="p">,</span> <span class="n">lineStartxyz</span><span class="o">-</span><span class="n">ptxyz</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">lineEndxyz</span><span class="o">-</span><span class="n">lineStartxyz</span><span class="p">)</span></div>



<div class="viewcode-block" id="ndarrayToListOfTuple3">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.ndarrayToListOfTuple3">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">ndarrayToListOfTuple3</span><span class="p">(</span><span class="n">ndArrayIn</span><span class="p">):</span>
    <span class="n">xyzOut</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ndarray3</span> <span class="ow">in</span> <span class="n">ndArrayIn</span><span class="p">:</span>
        <span class="n">xyzOut</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">ndarray3</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">xyzOut</span></div>



<div class="viewcode-block" id="diff">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.diff">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">diff</span><span class="p">(</span><span class="n">myList</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">myList</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">myList</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="n">mydiff</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">a</span>
    <span class="k">return</span> <span class="n">mydiff</span></div>



<div class="viewcode-block" id="circleFit2DErr">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.circleFit2DErr">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">circleFit2DErr</span><span class="p">(</span><span class="n">allParams</span><span class="p">,</span> <span class="n">xData</span><span class="p">,</span> <span class="n">yData</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Fit a circle to points</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># pts = [(np.linalg.norm([x-allParams[0],y-allParams[1]])-allParams[2])*w for x,y,w in zip(xData,yData,allParams[3:])]</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">([</span><span class="n">x</span> <span class="o">-</span> <span class="n">allParams</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span> <span class="o">-</span> <span class="n">allParams</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span> <span class="o">-</span> <span class="n">allParams</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xData</span><span class="p">,</span> <span class="n">yData</span><span class="p">)]</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span></div>


<div class="viewcode-block" id="distanceToPlane">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.distanceToPlane">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">distanceToPlane</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="c1"># Plane through point p0, with normal n. Point x</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p0</span><span class="p">))</span></div>


<div class="viewcode-block" id="residualPlane">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.residualPlane">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">residualPlane</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">):</span>
    <span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">pz</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span> <span class="o">=</span> <span class="n">parameters</span>
    <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">distances</span> <span class="o">=</span> <span class="p">[</span><span class="n">distanceToPlane</span><span class="p">([</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">pz</span><span class="p">],</span> <span class="p">[</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nz</span><span class="p">],</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">distances</span></div>


<div class="viewcode-block" id="residualsCircle">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.residualsCircle">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">residualsCircle</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">sArr</span><span class="p">,</span> <span class="n">rArr</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">):</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">Ri</span> <span class="o">=</span> <span class="n">parameters</span>
    <span class="n">planePointArr</span> <span class="o">=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">sArr</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">rArr</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">planePointArr</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]))</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">)]</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Ri</span> <span class="o">-</span> <span class="n">dist</span><span class="p">)</span> <span class="k">for</span> <span class="n">dist</span> <span class="ow">in</span> <span class="n">distance</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="icp">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.icp">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">icp</span><span class="p">(</span><span class="n">sourcePts</span><span class="p">,</span> <span class="n">targetPts</span><span class="p">,</span> <span class="n">max_iterations</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterative Closest Point (ICP) algorithm for point set registration.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - X: A numpy array of shape (N, 3) representing the source set of 3D points.</span>
<span class="sd">    - Y: A numpy array of shape (M, 3) representing the target set of 3D points.</span>
<span class="sd">    - max_iterations: Maximum number of iterations for the algorithm (default=100).</span>
<span class="sd">    - tolerance: Convergence criterion based on the change in error (default=1e-6).</span>

<span class="sd">    Returns:</span>
<span class="sd">    - R_best: A 3x3 numpy array representing the best rotation matrix.</span>
<span class="sd">    - t_best: A 1x3 numpy array representing the best translation vector.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R_best</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># Initial best rotation matrix (identity)</span>
    <span class="n">t_best</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># Initial best translation vector</span>
    <span class="n">min_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>  <span class="c1"># Initial minimum error</span>
    <span class="n">sourcePtsBest</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">rndIt_every</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_iterations</span><span class="o">/</span><span class="mf">5.0</span><span class="p">)</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">cKDTree</span><span class="p">(</span><span class="n">targetPts</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iterations</span><span class="p">):</span>
        <span class="n">distances</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">sourcePts</span><span class="p">)</span>
        <span class="n">Y_matched</span> <span class="o">=</span> <span class="n">targetPts</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
        <span class="n">centroid_X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sourcePts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">centroid_Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Y_matched</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">X_centered</span> <span class="o">=</span> <span class="n">sourcePts</span> <span class="o">-</span> <span class="n">centroid_X</span>
        <span class="n">Y_centered</span> <span class="o">=</span> <span class="n">Y_matched</span> <span class="o">-</span> <span class="n">centroid_Y</span>

        <span class="n">covariance_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Y_centered</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">X_centered</span><span class="p">)</span>
        <span class="n">U</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">Vt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">covariance_matrix</span><span class="p">)</span>

        <span class="n">R_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">Vt</span><span class="p">)</span>
        <span class="n">t_new</span> <span class="o">=</span> <span class="n">centroid_Y</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R_new</span><span class="p">,</span> <span class="n">centroid_X</span><span class="p">)</span>

        <span class="n">sourcePts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sourcePts</span><span class="p">,</span> <span class="n">R_new</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">+</span> <span class="n">t_new</span>

        <span class="n">total_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">total_error</span> <span class="o">&lt;</span> <span class="n">min_error</span><span class="p">:</span>
            <span class="n">min_error</span> <span class="o">=</span> <span class="n">total_error</span>
            <span class="n">R_best</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R_new</span><span class="p">,</span> <span class="n">R_best</span><span class="p">)</span>
            <span class="n">t_best</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R_new</span><span class="p">,</span> <span class="n">t_best</span><span class="p">)</span> <span class="o">+</span> <span class="n">t_new</span>
            <span class="n">sourcePtsBest</span> <span class="o">=</span> <span class="n">sourcePts</span>

        <span class="k">if</span> <span class="n">total_error</span> <span class="o">&lt;</span> <span class="n">tolerance</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="k">return</span> <span class="n">R_best</span><span class="p">,</span> <span class="n">t_best</span><span class="p">,</span> <span class="n">sourcePtsBest</span></div>


<div class="viewcode-block" id="fitPlane3DOptimize">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.fitPlane3DOptimize">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">fitPlane3DOptimize</span><span class="p">(</span><span class="n">pts</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">pts</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">estPlane</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">bestFitValues</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">leastsq</span><span class="p">(</span><span class="n">residualPlane</span><span class="p">,</span> <span class="n">estPlane</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">xF</span><span class="p">,</span> <span class="n">yF</span><span class="p">,</span> <span class="n">zF</span><span class="p">,</span> <span class="n">tF</span><span class="p">,</span> <span class="n">pF</span> <span class="o">=</span> <span class="n">bestFitValues</span>
    <span class="n">point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xF</span><span class="p">,</span> <span class="n">yF</span><span class="p">,</span> <span class="n">zF</span><span class="p">])</span>
    <span class="n">normal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tF</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">pF</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tF</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">pF</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">tF</span><span class="p">)])</span>
    <span class="k">return</span> <span class="n">normal</span><span class="p">,</span> <span class="n">point</span></div>



<div class="viewcode-block" id="fitCircle3D">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.fitCircle3D">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">fitCircle3D</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">xm</span><span class="p">,</span> <span class="n">ym</span><span class="p">,</span> <span class="n">zm</span><span class="p">,</span> <span class="n">rm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fit a circle to 3D points.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - x, y, z: Arrays of x, y, and z coordinates of the points.</span>
<span class="sd">    - xm, ym, zm: Coordinates of the center of the circle.</span>
<span class="sd">    - rm: Radius of the circle.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - centerPointArr: Coordinates of the center of the circle.</span>
<span class="sd">    - RiF: Radius of the circle.</span>
<span class="sd">    - normal: Normal vector of the plane containing the circle.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">estPlane</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xm</span><span class="p">,</span> <span class="n">ym</span><span class="p">,</span> <span class="n">zm</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="c1"># print residualsPlane(estPlane, pts)</span>
    <span class="n">bestFitValues</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">leastsq</span><span class="p">(</span><span class="n">residualPlane</span><span class="p">,</span> <span class="n">estPlane</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">xF</span><span class="p">,</span> <span class="n">yF</span><span class="p">,</span> <span class="n">zF</span><span class="p">,</span> <span class="n">tF</span><span class="p">,</span> <span class="n">pF</span> <span class="o">=</span> <span class="n">bestFitValues</span>

    <span class="n">point</span> <span class="o">=</span> <span class="p">[</span><span class="n">xF</span><span class="p">,</span> <span class="n">yF</span><span class="p">,</span> <span class="n">zF</span><span class="p">]</span>
    <span class="n">normal</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tF</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">pF</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tF</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">pF</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">tF</span><span class="p">)]</span>

    <span class="c1"># Fitting a circle inside the plane</span>
    <span class="c1"># creating two inplane vectors</span>
    <span class="n">sArr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">normal</span><span class="p">))</span>  <span class="c1"># assuming that normal not parallel x!</span>
    <span class="n">sArr</span> <span class="o">=</span> <span class="n">sArr</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">sArr</span><span class="p">)</span>
    <span class="n">rArr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">sArr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">normal</span><span class="p">))</span>
    <span class="n">rArr</span> <span class="o">=</span> <span class="n">rArr</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">rArr</span><span class="p">)</span>  <span class="c1"># should be normalized already, but anyhow</span>

    <span class="n">estimateCircle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">rm</span><span class="p">])</span>  <span class="c1"># px,py,pz and zeta, phi</span>
    <span class="n">bestCircleFitValues</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">leastsq</span><span class="p">(</span><span class="n">residualsCircle</span><span class="p">,</span> <span class="n">estimateCircle</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">sArr</span><span class="p">,</span> <span class="n">rArr</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">rF</span><span class="p">,</span> <span class="n">sF</span><span class="p">,</span> <span class="n">RiF</span> <span class="o">=</span> <span class="n">bestCircleFitValues</span>
    <span class="n">centerPointArr</span> <span class="o">=</span> <span class="n">sF</span> <span class="o">*</span> <span class="n">sArr</span> <span class="o">+</span> <span class="n">rF</span> <span class="o">*</span> <span class="n">rArr</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
    <span class="c1"># synthetic=[list(centerPointArr+ RiF*np.cos(phi)*rArr+RiF*np.sin(phi)*sArr) for phi in np.linspace(0, 2*np.pi,50)]</span>
    <span class="c1"># [cxTupel,cyTupel,czTupel]=[ x for x in zip(*synthetic)]</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">centerPointArr</span><span class="p">,</span> <span class="n">RiF</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">sArr</span><span class="p">,</span> <span class="n">rArr</span><span class="p">))</span></div>



<div class="viewcode-block" id="lagBetweenTwoCurves">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.lagBetweenTwoCurves">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">lagBetweenTwoCurves</span><span class="p">(</span><span class="n">y1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">y2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">timeArray</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the lag (delay) between two similar time series curves.</span>

<span class="sd">    This function uses cross-correlation to determine the time delay between two signals.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - y1 (np.array): First time series.</span>
<span class="sd">    - y2 (np.array): Second time series.</span>
<span class="sd">    - timeArray (np.array, optional): Array of time points corresponding to y1 and y2. </span>
<span class="sd">      If None, a normalized time array from -0.5 to 0.5 is used. Default is None.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - float: The time delay between the two signals. A positive value indicates </span>
<span class="sd">             that y2 lags behind y1, while a negative value indicates that y1 lags behind y2.</span>

<span class="sd">    Note:</span>
<span class="sd">    - The two input arrays (y1 and y2) must have the same length.</span>
<span class="sd">    - If timeArray is provided, it must have the same length as y1 and y2.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
    <span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="p">)])</span>
    <span class="k">if</span> <span class="n">timeArray</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">delay_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">delay_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">timeArray</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">delay</span> <span class="o">=</span> <span class="n">delay_arr</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">corr</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">delay</span></div>



<div class="viewcode-block" id="calculatePlaneThreePoints">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.calculatePlaneThreePoints">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">calculatePlaneThreePoints</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Plane from three points (v0(p0 to p1) and v1(p0 to p2) -&gt; cross == norm, p2 for D)</span>
<span class="sd">        Return [A,B,C,D]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">v0</span><span class="p">,</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span>
    <span class="n">n0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v0</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span>
    <span class="n">n0</span> <span class="o">=</span> <span class="n">n0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">n0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">getPlaneConstantsFromPointAndVector</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">n0</span><span class="p">)</span></div>



<div class="viewcode-block" id="getPlaneConstantsFromPointAndVector">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.getPlaneConstantsFromPointAndVector">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">getPlaneConstantsFromPointAndVector</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">vector</span><span class="p">):</span>
    <span class="n">D</span> <span class="o">=</span> <span class="o">-</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">vector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">vector</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">vector</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">plane</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">vector</span><span class="p">,</span> <span class="n">D</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">plane</span></div>



<div class="viewcode-block" id="calculateDerivativeOnLine_backwardDiff">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.calculateDerivativeOnLine_backwardDiff">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">calculateDerivativeOnLine_backwardDiff</span><span class="p">(</span><span class="n">pim1</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Calculate the derivative of a line using backward difference. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dr_dt</span> <span class="o">=</span> <span class="p">[(</span><span class="n">m</span> <span class="o">-</span> <span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="n">dt</span> <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pim1</span><span class="p">,</span> <span class="n">pi</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">dr_dt</span></div>



<div class="viewcode-block" id="calculateSecondDerivativeOnLine">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.calculateSecondDerivativeOnLine">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">calculateSecondDerivativeOnLine</span><span class="p">(</span><span class="n">pim1</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">pip1</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
    <span class="n">d2r_dt2</span> <span class="o">=</span> <span class="p">[(</span><span class="n">p</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="n">dt</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pim1</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">pip1</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">d2r_dt2</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">__calcTNB</span><span class="p">(</span><span class="n">dr_dt</span><span class="p">,</span> <span class="n">d2r_dt2</span><span class="p">):</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">dr_dt</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">dr_dt</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">dr_dt</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">d2r_dt2</span><span class="p">,</span> <span class="n">dr_dt</span><span class="p">))</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">dr_dt</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">d2r_dt2</span><span class="p">,</span> <span class="n">dr_dt</span><span class="p">)))</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>


<div class="viewcode-block" id="calculateCurvature3Pts">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.calculateCurvature3Pts">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">calculateCurvature3Pts</span><span class="p">(</span><span class="n">pim1</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">pip1</span><span class="p">,</span> <span class="n">dx</span><span class="p">):</span>
    <span class="n">dr_dt</span> <span class="o">=</span> <span class="n">calculateDerivativeOnLine_backwardDiff</span><span class="p">(</span><span class="n">pim1</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
    <span class="n">d2r_dt2</span> <span class="o">=</span> <span class="n">calculateSecondDerivativeOnLine</span><span class="p">(</span><span class="n">pim1</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">pip1</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
    <span class="n">num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">dr_dt</span><span class="p">,</span> <span class="n">d2r_dt2</span><span class="p">))</span>
    <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">dr_dt</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">num</span> <span class="o">/</span> <span class="n">denom</span>
    <span class="n">TNB</span> <span class="o">=</span> <span class="n">__calcTNB</span><span class="p">(</span><span class="n">dr_dt</span><span class="p">,</span> <span class="n">d2r_dt2</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">TNB</span><span class="p">)</span></div>



<div class="viewcode-block" id="calculateCurvature_D">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.calculateCurvature_D">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">calculateCurvature_D</span><span class="p">(</span><span class="n">gf</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">ggf</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">):</span>
    <span class="n">num</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gf</span><span class="p">,</span> <span class="n">ggf</span><span class="p">)]</span>
    <span class="n">denom</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gf</span><span class="p">]</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">denom</span><span class="p">)</span>
    <span class="n">TNB</span> <span class="o">=</span> <span class="p">[</span><span class="n">__calcTNB</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gf</span><span class="p">,</span> <span class="n">ggf</span><span class="p">)]</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">TNB</span><span class="p">)</span></div>



<div class="viewcode-block" id="setVectorDirection">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.setVectorDirection">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">setVectorDirection</span><span class="p">(</span><span class="n">vecIn</span><span class="p">,</span> <span class="n">oo</span><span class="p">,</span> <span class="n">pointMorePositive</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Will ensure vector at point oo is pointing towards &#39;pointMorePositive&#39; else flip&quot;&quot;&quot;</span>
    <span class="n">oo</span><span class="p">,</span> <span class="n">vecIn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">oo</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">vecIn</span><span class="p">)</span>
    <span class="n">dp</span><span class="p">,</span> <span class="n">dm</span> <span class="o">=</span> <span class="n">distTwoPoints</span><span class="p">(</span><span class="n">oo</span> <span class="o">+</span> <span class="n">vecIn</span><span class="p">,</span> <span class="n">pointMorePositive</span><span class="p">),</span> <span class="n">distTwoPoints</span><span class="p">(</span><span class="n">oo</span> <span class="o">-</span> <span class="n">vecIn</span><span class="p">,</span> <span class="n">pointMorePositive</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dp</span> <span class="o">&gt;</span> <span class="n">dm</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">vecIn</span>
    <span class="k">return</span> <span class="n">vecIn</span></div>



<div class="viewcode-block" id="buildRotationMatrix">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.buildRotationMatrix">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">buildRotationMatrix</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="n">theta_rad</span><span class="p">):</span>
    <span class="n">vec</span> <span class="o">=</span> <span class="n">vec</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span>
    <span class="n">RotM</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">)</span> <span class="o">+</span> <span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">)),</span> \
             <span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">))</span> <span class="o">-</span> <span class="n">vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">),</span> \
             <span class="n">vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">)</span> <span class="o">+</span> <span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">))],</span> \
            <span class="p">[</span><span class="n">vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">)</span> <span class="o">+</span> <span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">)),</span> \
             <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">)</span> <span class="o">+</span> <span class="n">vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">)),</span> \
             <span class="o">-</span><span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">)</span> <span class="o">+</span> <span class="n">vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">))],</span> \
            <span class="p">[</span><span class="o">-</span><span class="n">vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">)</span> <span class="o">+</span> <span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">)),</span> \
             <span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">)</span> <span class="o">+</span> <span class="n">vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">)),</span> \
             <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">)</span> <span class="o">+</span> <span class="n">vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">))]]</span>
    <span class="k">return</span> <span class="n">RotM</span></div>



<div class="viewcode-block" id="adjustPointsCenterOfMassToOrigin">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.adjustPointsCenterOfMassToOrigin">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">adjustPointsCenterOfMassToOrigin</span><span class="p">(</span><span class="n">pts</span><span class="p">):</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">__forcePts_nx3</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>
    <span class="n">centerOfMass</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pts</span> <span class="o">-</span> <span class="n">centerOfMass</span></div>



<div class="viewcode-block" id="areVecsConsistent">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.areVecsConsistent">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">areVecsConsistent</span><span class="p">(</span><span class="n">vecA</span><span class="p">,</span> <span class="n">vecB</span><span class="p">):</span>
    <span class="n">vecA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vecA</span><span class="p">)</span>
    <span class="n">vecB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vecB</span><span class="p">)</span>
    <span class="n">nA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vecA</span><span class="p">)</span>
    <span class="n">nB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vecB</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nA</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">vecA</span> <span class="o">=</span> <span class="n">vecA</span> <span class="o">/</span> <span class="n">nA</span>
    <span class="k">if</span> <span class="n">nB</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">vecB</span> <span class="o">=</span> <span class="n">vecB</span> <span class="o">/</span> <span class="n">nB</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vecB</span> <span class="o">-</span> <span class="n">vecA</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vecB</span> <span class="o">-</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">vecA</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span></div>



<div class="viewcode-block" id="setVecAConsitentWithVecB">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.setVecAConsitentWithVecB">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">setVecAConsitentWithVecB</span><span class="p">(</span><span class="n">vecA</span><span class="p">,</span> <span class="n">vecB</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     Make vec dir consistant with poly order</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">areVecsConsistent</span><span class="p">(</span><span class="n">vecA</span><span class="p">,</span> <span class="n">vecB</span><span class="p">):</span>
        <span class="n">vecA</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">vecA</span>
    <span class="k">return</span> <span class="n">vecA</span></div>



<div class="viewcode-block" id="buildConvexHUll3D">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.buildConvexHUll3D">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">buildConvexHUll3D</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">nPts</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">planeABCD</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">TO_SPLINE</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">planeABCD</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">planeABCD</span> <span class="o">=</span> <span class="n">fitPlaneToPoints</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
    <span class="n">xy</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">origin</span> <span class="o">=</span> <span class="n">project3DPointsToPlanarCoordinateSystem</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">planeABCD</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">xyL</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xy</span><span class="p">]</span>
    <span class="n">chxy</span> <span class="o">=</span> <span class="n">convexHull</span><span class="p">(</span><span class="n">xyL</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">TO_SPLINE</span><span class="p">:</span>
        <span class="n">chxys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">splinePoints</span><span class="p">(</span><span class="n">chxy</span><span class="p">,</span> <span class="n">nPts</span><span class="p">,</span> <span class="n">periodic</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># chxys = splinePoints(np.array(chxy).T, nPts, periodic=1, RETURN_NUMPY=True)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">chxys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">chxy</span><span class="p">)</span>
    <span class="n">chxyz</span> <span class="o">=</span> <span class="n">convert2DPointsTo3DCoordinateSystem</span><span class="p">(</span><span class="n">chxys</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">origin</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">chxyz</span><span class="p">)</span></div>



<div class="viewcode-block" id="orderPointsConvexHull_IDs">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.orderPointsConvexHull_IDs">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">orderPointsConvexHull_IDs</span><span class="p">(</span><span class="n">xyz</span><span class="p">):</span>
    <span class="n">planeABCD</span> <span class="o">=</span> <span class="n">fitPlaneToPoints</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
    <span class="n">xy</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">origin</span> <span class="o">=</span> <span class="n">project3DPointsToPlanarCoordinateSystem</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">planeABCD</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">xyL</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xy</span><span class="p">]</span>
    <span class="n">chxy</span> <span class="o">=</span> <span class="n">convexHull</span><span class="p">(</span><span class="n">xyL</span><span class="p">)</span>
    <span class="n">IDs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chxy</span><span class="p">)):</span>
        <span class="n">dd</span> <span class="o">=</span> <span class="n">distPointPoints</span><span class="p">(</span><span class="n">chxy</span><span class="p">[</span><span class="n">k1</span><span class="p">],</span> <span class="n">xy</span><span class="p">)</span>
        <span class="n">iID</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>
        <span class="n">IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iID</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">IDs</span></div>



<div class="viewcode-block" id="orderPointsConvexHull">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.orderPointsConvexHull">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">orderPointsConvexHull</span><span class="p">(</span><span class="n">xyz</span><span class="p">):</span>
    <span class="n">IDs</span> <span class="o">=</span> <span class="n">orderPointsConvexHull_IDs</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
    <span class="n">pts_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xyz</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">IDs</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">pts_out</span></div>



<div class="viewcode-block" id="groupContinuousLinesByTol">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.groupContinuousLinesByTol">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">groupContinuousLinesByTol</span><span class="p">(</span><span class="n">ptsIn</span><span class="p">,</span> <span class="n">tol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; pts is N x 3 array of pts forming continuous lines (at least one)</span>
<span class="sd">        separated by gaps of &#39;tol&#39;</span>
<span class="sd">        Returns list of pts separated</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">ptsIn</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">listOut</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pi</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">currPts</span> <span class="o">=</span> <span class="p">[</span><span class="n">pi</span><span class="p">]</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">dd</span> <span class="o">=</span> <span class="n">distPointPoints</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">pts</span><span class="p">)</span>
        <span class="n">nextId</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dd</span><span class="p">[</span><span class="n">nextId</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">:</span>
            <span class="n">pi</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">nextId</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">currPts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">nextId</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">listOut</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">currPts</span><span class="p">))</span>
            <span class="n">pi</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">nextId</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">currPts</span> <span class="o">=</span> <span class="p">[</span><span class="n">pi</span><span class="p">]</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">nextId</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">listOut</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">currPts</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">listOut</span></div>



<div class="viewcode-block" id="buildContinuousLineByClosestPt">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.buildContinuousLineByClosestPt">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">buildContinuousLineByClosestPt</span><span class="p">(</span><span class="n">ptsIn</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; pts is N x 3 array of pts</span>
<span class="sd">        returns points ordered by proximity</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">ptsIn</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">pi</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">currPts</span> <span class="o">=</span> <span class="p">[</span><span class="n">pi</span><span class="p">]</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">dd</span> <span class="o">=</span> <span class="n">distPointPoints</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">pts</span><span class="p">)</span>
        <span class="n">nextId</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>
        <span class="n">pi</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">nextId</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">currPts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">nextId</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">currPts</span><span class="p">)</span></div>



<div class="viewcode-block" id="accumulatedAverage">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.accumulatedAverage">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">accumulatedAverage</span><span class="p">(</span><span class="n">arrayIn</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calc array that is average from start to i of input</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">aOut</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">arrayIn</span><span class="p">[:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arrayIn</span><span class="p">))]</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">aOut</span><span class="p">)</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">interpolateNANsFromSurroundingValues_linear</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; This is linear temporal interpolation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="n">array</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span><span class="n">mask</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span><span class="o">~</span><span class="n">mask</span><span class="p">),</span> <span class="n">array</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">array</span>


<div class="viewcode-block" id="interpolateNANsFromSurroundingValues_cubic">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.interpolateNANsFromSurroundingValues_cubic">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">interpolateNANsFromSurroundingValues_cubic</span><span class="p">(</span><span class="n">nparray</span><span class="p">):</span>
    <span class="n">arrayTF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">nparray</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">arrayTF</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">nparray</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="n">nparray</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">gridX</span><span class="p">,</span> <span class="n">gridY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">:</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="p">[[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gridX</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">gridY</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">arrayTF</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]]</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">nparray</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gridX</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">gridY</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">arrayTF</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">griddata</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="n">gridX</span><span class="p">,</span> <span class="n">gridY</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span></div>



<span class="c1"># ============ LINE SEG PIERCE TRIANGLE ========================================</span>
<div class="viewcode-block" id="doesLineSegPierceTriangle">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.doesLineSegPierceTriangle">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">doesLineSegPierceTriangle</span><span class="p">(</span><span class="n">lineP0</span><span class="p">,</span> <span class="n">lineP1</span><span class="p">,</span> <span class="n">triP0</span><span class="p">,</span> <span class="n">triP1</span><span class="p">,</span> <span class="n">triP2</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">doesLinePierceTriangle</span><span class="p">(</span><span class="n">lineP0</span><span class="p">,</span> <span class="n">lineP1</span><span class="p">,</span> <span class="n">triP0</span><span class="p">,</span> <span class="n">triP1</span><span class="p">,</span> <span class="n">triP2</span><span class="p">):</span>
        <span class="n">s4</span> <span class="o">=</span> <span class="n">pluckerSideOperator</span><span class="p">([</span><span class="n">triP1</span><span class="p">,</span> <span class="n">triP2</span><span class="p">],</span> <span class="p">[</span><span class="n">triP0</span><span class="p">,</span> <span class="n">lineP1</span><span class="p">])</span>
        <span class="n">s5</span> <span class="o">=</span> <span class="n">pluckerSideOperator</span><span class="p">([</span><span class="n">triP1</span><span class="p">,</span> <span class="n">triP2</span><span class="p">],</span> <span class="p">[</span><span class="n">lineP0</span><span class="p">,</span> <span class="n">triP0</span><span class="p">])</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">s4</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">s5</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">s4</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">s5</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span></div>



<div class="viewcode-block" id="doesLinePierceTriangle">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.doesLinePierceTriangle">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">doesLinePierceTriangle</span><span class="p">(</span><span class="n">lineP0</span><span class="p">,</span> <span class="n">lineP1</span><span class="p">,</span> <span class="n">triP0</span><span class="p">,</span> <span class="n">triP1</span><span class="p">,</span> <span class="n">triP2</span><span class="p">):</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="n">pluckerSideOperator</span><span class="p">([</span><span class="n">lineP0</span><span class="p">,</span> <span class="n">lineP1</span><span class="p">],</span> <span class="p">[</span><span class="n">triP0</span><span class="p">,</span> <span class="n">triP1</span><span class="p">])</span>
    <span class="n">s3</span> <span class="o">=</span> <span class="n">pluckerSideOperator</span><span class="p">([</span><span class="n">lineP0</span><span class="p">,</span> <span class="n">lineP1</span><span class="p">],</span> <span class="p">[</span><span class="n">triP1</span><span class="p">,</span> <span class="n">triP2</span><span class="p">])</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="n">pluckerSideOperator</span><span class="p">([</span><span class="n">lineP0</span><span class="p">,</span> <span class="n">lineP1</span><span class="p">],</span> <span class="p">[</span><span class="n">triP2</span><span class="p">,</span> <span class="n">triP0</span><span class="p">])</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">s1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">s2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">s3</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">s1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">s2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">s3</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="kc">False</span></div>



<div class="viewcode-block" id="pluckerSideOperator">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.pluckerSideOperator">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">pluckerSideOperator</span><span class="p">(</span><span class="n">line0</span><span class="p">,</span> <span class="n">line1</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">pluckerLine</span><span class="p">(</span><span class="n">line0</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">pluckerLine</span><span class="p">(</span><span class="n">line1</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">value</span></div>


<div class="viewcode-block" id="pluckerLine">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.pluckerLine">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">pluckerLine</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="c1"># line is 2 x 3</span>
    <span class="n">L0</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">L1</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">L2</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">L3</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">L4</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">L5</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">L0</span><span class="p">,</span> <span class="n">L1</span><span class="p">,</span> <span class="n">L2</span><span class="p">,</span> <span class="n">L3</span><span class="p">,</span> <span class="n">L4</span><span class="p">,</span> <span class="n">L5</span><span class="p">]</span></div>



<div class="viewcode-block" id="doesVectorPierceAnyTriangle">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.doesVectorPierceAnyTriangle">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">doesVectorPierceAnyTriangle</span><span class="p">(</span><span class="n">vS</span><span class="p">,</span> <span class="n">vE</span><span class="p">,</span> <span class="n">triPolyData</span><span class="p">):</span>
    <span class="n">nTris</span> <span class="o">=</span> <span class="n">triPolyData</span><span class="o">.</span><span class="n">GetNumberOfCells</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">k2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nTris</span><span class="p">):</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">triPolyData</span><span class="o">.</span><span class="n">GetPoint</span><span class="p">(</span><span class="n">triPolyData</span><span class="o">.</span><span class="n">GetCell</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span><span class="o">.</span><span class="n">GetPointIds</span><span class="p">()</span><span class="o">.</span><span class="n">GetId</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">triPolyData</span><span class="o">.</span><span class="n">GetPoint</span><span class="p">(</span><span class="n">triPolyData</span><span class="o">.</span><span class="n">GetCell</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span><span class="o">.</span><span class="n">GetPointIds</span><span class="p">()</span><span class="o">.</span><span class="n">GetId</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">triPolyData</span><span class="o">.</span><span class="n">GetPoint</span><span class="p">(</span><span class="n">triPolyData</span><span class="o">.</span><span class="n">GetCell</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span><span class="o">.</span><span class="n">GetPointIds</span><span class="p">()</span><span class="o">.</span><span class="n">GetId</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">doesLineSegPierceTriangle</span><span class="p">(</span><span class="n">vS</span><span class="p">,</span> <span class="n">vE</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">k2</span>
    <span class="k">return</span> <span class="kc">None</span></div>



<span class="c1"># ==========================================================================</span>
<span class="c1"># ==========================================================================</span>
<div class="viewcode-block" id="calculateBSA">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.calculateBSA">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">calculateBSA</span><span class="p">(</span><span class="n">height_cm</span><span class="p">,</span> <span class="n">weight_kg</span><span class="p">,</span> <span class="n">METHOD</span><span class="o">=</span><span class="s1">&#39;DuBois&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">METHOD</span> <span class="o">==</span> <span class="s1">&#39;DuBois&#39;</span><span class="p">:</span>
        <span class="n">BSA</span> <span class="o">=</span> <span class="mf">0.007184</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">height_cm</span><span class="p">,</span> <span class="mf">0.725</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">weight_kg</span><span class="p">,</span> <span class="mf">0.425</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Method unknown. Use one of: </span><span class="si">{DuBois}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">BSA</span></div>



<span class="c1"># ==========================================================================</span>
<span class="c1"># RANDOM CLASSES</span>
<span class="c1"># ==========================================================================</span>
<div class="viewcode-block" id="interpolateNANsFromSurroundingValues_linear">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.interpolateNANsFromSurroundingValues_linear">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">interpolateNANsFromSurroundingValues_linear</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; This is linear temporal interpolation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="n">array</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span><span class="n">mask</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span><span class="o">~</span><span class="n">mask</span><span class="p">),</span> <span class="n">array</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">array</span></div>



<span class="c1">######################################################################</span>
<span class="c1"># CONVEX HULL</span>
<span class="c1">######################################################################</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Calculate the convex hull of a set of n 2D-points in O(n log n) time.  </span>
<span class="sd">Taken from Berg et al., Computational Geometry, Springer-Verlag, 1997.</span>
<span class="sd">Dinu C. Gherman</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_myDet</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calc. determinant of a special matrix with three 2D points.</span>
<span class="sd">    The sign, &quot;-&quot; or &quot;+&quot;, determines the side, right or left,</span>
<span class="sd">    respectivly, on which the point r lies, when measured against</span>
<span class="sd">    a directed vector from p to q.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># We use Sarrus&#39; Rule to calculate the determinant.</span>
    <span class="c1"># (could also use the Numeric package...)</span>
    <span class="n">sum1</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">sum2</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">sum1</span> <span class="o">-</span> <span class="n">sum2</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_isRightTurn</span><span class="p">(</span><span class="n">pqr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Do the vectors pq:qr form a right turn, or not?&quot;&quot;&quot;</span>
    <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="o">=</span> <span class="n">pqr</span>
    <span class="k">assert</span> <span class="n">p</span> <span class="o">!=</span> <span class="n">q</span> <span class="ow">and</span> <span class="n">q</span> <span class="o">!=</span> <span class="n">r</span> <span class="ow">and</span> <span class="n">p</span> <span class="o">!=</span> <span class="n">r</span>
    <span class="k">if</span> <span class="n">_myDet</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_isPointInPolygon</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Is point r inside a given polygon P?&quot;&quot;&quot;</span>
    <span class="c1"># We assume the polygon is a list of points, listed clockwise!</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">P</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])):</span>
        <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_isRightTurn</span><span class="p">((</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">r</span><span class="p">)):</span>
            <span class="k">return</span> <span class="mi">0</span>  <span class="c1"># Out!</span>
    <span class="k">return</span> <span class="mi">1</span>  <span class="c1"># It&#39;s within!</span>


<div class="viewcode-block" id="convexHull">
<a class="viewcode-back" href="../../api/ftk.html#ngawari.ftk.convexHull">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">convexHull</span><span class="p">(</span><span class="n">P</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the convex hull of a set of points.&quot;&quot;&quot;</span>
    <span class="c1"># Remove any duplicates</span>
    <span class="c1"># If the hull has a duplicate point, it will be returned once</span>
    <span class="c1"># It is up to the application to handle it correctly</span>
    <span class="n">unique</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">P</span><span class="p">:</span>
        <span class="n">unique</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">points</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">unique</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">points</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="c1"># Build upper half of the hull.</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="p">[</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
        <span class="n">upper</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">upper</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_isRightTurn</span><span class="p">(</span><span class="n">upper</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]):</span>
            <span class="k">del</span> <span class="n">upper</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="c1"># Build lower half of the hull.</span>
    <span class="n">points</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="p">[</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
        <span class="n">lower</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_isRightTurn</span><span class="p">(</span><span class="n">lower</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]):</span>
            <span class="k">del</span> <span class="n">lower</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="c1"># Remove duplicates.</span>
    <span class="k">del</span> <span class="n">lower</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">del</span> <span class="n">lower</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># Concatenate both halfs and return.</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">upper</span> <span class="o">+</span> <span class="n">lower</span><span class="p">)</span></div>



<span class="c1">######################################################################</span>
<span class="c1">######################################################################</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Fraser M. Callaghan.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>